<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Loter√≠as</title>
  <link rel="stylesheet" href="css/styles.css?v=20260205e">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body>

  <!-- LOGIN -->
  <div id="login-view" class="login-container">
    <!-- Panel izquierdo con logo y fondo geom√©trico -->
    <div class="login-left-panel">
      <div class="login-brand">
        <img src="assets/logo.svg" alt="Logo" class="login-logo">
        <h2 class="brand-name">SIMBA</h2>
        <p class="brand-tagline">Sistema de Control de Loter√≠as</p>
        <span class="brand-version">v2.0</span>
      </div>
      <!-- Decoraci√≥n geom√©trica -->
      <div class="geometric-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
        <div class="shape shape-4"></div>
      </div>
    </div>

    <!-- Panel derecho con formulario -->
    <div class="login-right-panel">
      <div class="login-card">
        <div class="login-header">
          <div class="login-user-icon">
            <i class="fas fa-users"></i>
          </div>
        </div>

        <form id="login-form">
          <div class="form-group">
            <div class="input-with-icon">
              <i class="fas fa-user"></i>
              <input type="text" id="login-username" placeholder="Usuario" required>
            </div>
          </div>

          <div class="form-group">
            <div class="input-with-icon">
              <i class="fas fa-lock"></i>
              <input type="password" id="login-password" placeholder="Contrase√±a" required>
            </div>
          </div>

          <div id="login-error" class="alert alert-error hidden"></div>

          <button type="submit" class="btn btn-login">
            LOGIN
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- APP -->
  <div id="app-view" class="app-container hidden">

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <button class="sidebar-toggle" id="sidebar-toggle" title="Abrir/Cerrar men√∫">
          <img src="assets/logo.svg" alt="Logo" class="sidebar-logo">
        </button>
      </div>

      <nav class="nav-menu">
        <a class="nav-item active" data-view="dashboard">
          <i class="fas fa-home"></i> Dashboard
        </a>

        <div class="nav-section">Control</div>
        <a class="nav-item" data-view="control-previo">
          <i class="fas fa-clipboard-check"></i> Control Previo
        </a>
        <a class="nav-item" data-view="control-posterior">
          <i class="fas fa-calculator"></i> Control Posterior
        </a>

        <div class="nav-section">Configuraci√≥n</div>
        <a class="nav-item" data-view="programacion">
          <i class="fas fa-calendar-alt"></i> Programaci√≥n
        </a>

        <div class="nav-section">Documentos</div>
        <a class="nav-item" data-view="actas">
          <i class="fas fa-file-alt"></i> Actas
        </a>
        <a class="nav-item" data-view="reportes">
          <i class="fas fa-chart-bar"></i> Reportes
        </a>

        <div class="nav-section">Datos</div>
        <a class="nav-item" data-view="extractos">
          <i class="fas fa-list-ol"></i> Extractos
        </a>
        <a class="nav-item" data-view="agencias">
          <i class="fas fa-building"></i> Agencias
        </a>

        <div class="nav-section">Facturaci√≥n</div>
        <a class="nav-item" data-view="juegos-offline">
          <i class="fas fa-horse-head"></i> Juegos Offline
        </a>

        <div class="nav-section admin-only">Administraci√≥n</div>
        <a class="nav-item admin-only" data-view="usuarios">
          <i class="fas fa-users"></i> Usuarios
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-name" id="user-name">Usuario</div>
          <div class="user-role" id="user-role">Rol</div>
        </div>
        <button class="btn btn-sm btn-secondary" id="btn-logout">
          <i class="fas fa-sign-out-alt"></i> Salir
        </button>
        <div id="app-version"
          style="text-align: center; margin-top: 0.5rem; font-size: 0.7rem; color: var(--text-muted); opacity: 0.6;">
          v2.3.0
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

      <!-- Dashboard -->
      <section id="view-dashboard" class="view">
        <div class="page-header">
          <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
          <p id="dashboard-fecha">Sorteos del d√≠a</p>
        </div>

        <!-- Stats del d√≠a -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon blue"><i class="fas fa-calendar-day"></i></div>
            <div class="stat-value" id="stat-total-sorteos">0</div>
            <div class="stat-label">Sorteos Programados</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon orange"><i class="fas fa-clock"></i></div>
            <div class="stat-value" id="stat-pendientes">0</div>
            <div class="stat-label">Pendientes</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon green"><i class="fas fa-clipboard-check"></i></div>
            <div class="stat-value" id="stat-control-previo">0</div>
            <div class="stat-label">Control Previo</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon purple"><i class="fas fa-check-double"></i></div>
            <div class="stat-value" id="stat-escrutados">0</div>
            <div class="stat-label">Escrutados</div>
          </div>
        </div>

        <!-- Totales -->
        <div class="stats-grid" style="margin-top: 1rem;">
          <div class="stat-card" style="flex: 2;">
            <div class="stat-icon green"><i class="fas fa-dollar-sign"></i></div>
            <div class="stat-value" id="stat-recaudacion-total">$0</div>
            <div class="stat-label">Recaudaci√≥n Total (Control Previo)</div>
          </div>
          <div class="stat-card" style="flex: 2;">
            <div class="stat-icon red"><i class="fas fa-trophy"></i></div>
            <div class="stat-value" id="stat-premios-total">$0</div>
            <div class="stat-label">Premios Pagados (Escrutinio)</div>
          </div>
        </div>

        <!-- Tabla de Sorteos del D√≠a -->
        <div class="card">
          <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3><i class="fas fa-list"></i> Sorteos del D√≠a</h3>
            <input type="date" id="dashboard-fecha-input" class="form-control" style="width: auto;">
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table" id="tabla-sorteos-dia">
                <thead>
                  <tr>
                    <th>Sorteo</th>
                    <th>Juego</th>
                    <th>Hora</th>
                    <th>Modalidad</th>
                    <th>Estado</th>
                    <th>Recaudaci√≥n</th>
                    <th>Premios</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="tbody-sorteos-dia">
                  <tr>
                    <td colspan="8" class="text-center text-muted">
                      <i class="fas fa-spinner fa-spin"></i> Cargando sorteos...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Sin programaci√≥n -->
        <div class="card hidden" id="dashboard-sin-programacion">
          <div class="card-body text-center" style="padding: 3rem;">
            <i class="fas fa-calendar-times"
              style="font-size: 4rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
            <h3>No hay sorteos programados</h3>
            <p class="text-muted">Cargue la programaci√≥n del mes desde el men√∫ <strong>Programaci√≥n</strong> para ver
              los sorteos del d√≠a.</p>
            <button class="btn btn-primary" onclick="navigateTo('programacion')">
              <i class="fas fa-upload"></i> Cargar Programaci√≥n
            </button>
          </div>
        </div>
      </section>

      <!-- Archivos -->
      <section id="view-archivos" class="view hidden">
        <div class="page-header">
          <h1>Cargar Archivos</h1>
          <p>Cargue archivos NTF, ZIP, XML o JSON</p>
        </div>

        <div class="card">
          <div class="form-row">
            <div class="form-group">
              <label>Juego</label>
              <select id="archivo-juego" class="form-control">
                <option value="">Seleccione juego</option>
              </select>
            </div>
            <div class="form-group">
              <label>Sorteo</label>
              <select id="archivo-sorteo" class="form-control">
                <option value="">Seleccione sorteo</option>
              </select>
            </div>
            <div class="form-group">
              <label>Fecha</label>
              <input type="date" id="archivo-fecha" class="form-control">
            </div>
          </div>

          <div class="upload-area" id="upload-area">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Arrastre archivos aqu√≠ o haga clic para seleccionar</p>
            <span>NTF, ZIP, XML, JSON, PDF, Im√°genes</span>
            <input type="file" id="archivo-input" multiple accept=".ntf,.zip,.xml,.json,.pdf,.jpg,.jpeg,.png" hidden>
          </div>

          <div id="archivos-lista" class="files-list"></div>

          <div class="form-actions">
            <button class="btn btn-primary" onclick="procesarArchivos()">
              <i class="fas fa-upload"></i> Procesar Archivos
            </button>
          </div>
        </div>
      </section>

      <!-- Extractos -->
      <section id="view-extractos" class="view hidden">
        <div class="page-header">
          <h1>Extractos</h1>
          <p>Carga y gesti√≥n de extractos oficiales</p>
        </div>

        <div class="card">
          <div class="tabs">
            <button class="tab active" data-tab="cargar">Cargar Extracto</button>
            <button class="tab" data-tab="ver">Ver Extractos</button>
          </div>

          <div class="tab-content" id="tab-cargar">
            <!-- 1. Selecci√≥n de Provincia/Extracto -->
            <div class="form-group mb-4">
              <label>Provincia/Extracto</label>
              <select id="extracto-provincia" class="form-control">
                <option value="51">CABA</option>
                <option value="53">Buenos Aires</option>
                <option value="55">C√≥rdoba</option>
                <option value="72">Santa Fe</option>
                <option value="59">Entre R√≠os</option>
                <option value="64">Mendoza</option>
                <option value="00">Montevideo</option>
              </select>
            </div>

            <!-- Nuevo Dise√±o Simplificado -->
            <div class="ocr-container-simple">
              <div class="row g-3">
                <div class="col-md-12">
                  <div class="file-upload-area unified-upload" id="extracto-unified-area"
                    style="min-height: 200px; border: 2px dashed var(--primary); background: rgba(37, 99, 235, 0.05);">
                    <input type="file" id="extracto-unified-input" accept=".xml,.pdf,image/*" multiple class="hidden">
                    <div class="file-upload-content">
                      <i class="fas fa-cloud-upload-alt fa-4x mb-3" style="color: var(--primary);"></i>
                      <h4 style="margin-bottom: 0.5rem;">Carga Inteligente de Extractos</h4>
                      <p>Arrastr√° aqu√≠ tus archivos <strong>Im√°genes, PDFs o XML</strong></p>
                      <small class="text-muted">El sistema detectar√° autom√°ticamente el formato y procesar√° los
                        datos</small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Acciones R√°pidas -->
              <div class="d-flex justify-content-center gap-2 mt-4">
                <button class="btn btn-outline-primary" onclick="capturarPantallaExtracto()">
                  <i class="fas fa-desktop"></i> Capturar Pantalla
                </button>
                <button class="btn btn-outline-secondary" onclick="toggleManualInput()">
                  <i class="fas fa-keyboard"></i> Carga Manual
                </button>
              </div>

              <!-- Vista Previa de Imagen capturada o procesada -->
              <div id="ocr-preview" class="hidden mt-4 text-center">
                <div class="card p-2" style="background: var(--bg-input);">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="m-0">Vista Previa</h5>
                    <button class="btn btn-sm btn-danger" onclick="cancelarProcesamiento()">&times;</button>
                  </div>
                  <img id="ocr-preview-img" class="img-fluid rounded" style="max-height: 400px; object-fit: contain;">
                  <div class="mt-3">
                    <button class="btn btn-primary btn-lg w-100" id="btn-procesar-ocr-simple"
                      onclick="procesarImagenOCR()">
                      <i class="fas fa-magic"></i> Extraer N√∫meros con IA
                    </button>
                  </div>
                </div>
              </div>

              <!-- Contenedor Manual (Oculto por defecto) -->
              <div id="manual-input-container" class="hidden mt-4 card" style="border-top: 3px solid var(--warning);">
                <div class="card-header d-flex justify-content-between">
                  <h4 class="m-0">Carga Manual</h4>
                  <button class="btn-close" onclick="toggleManualInput()">&times;</button>
                </div>
                <div class="card-body">
                  <div class="form-row">
                    <div class="form-group col-md-4">
                      <label>Fecha</label>
                      <input type="date" id="extracto-fecha-manual" class="form-control">
                    </div>
                    <div class="form-group col-md-4">
                      <label>Modalidad</label>
                      <select id="extracto-modalidad-manual" class="form-control">
                        <option value="R">La Previa</option>
                        <option value="P">La Primera</option>
                        <option value="M">Matutina</option>
                        <option value="V">Vespertina</option>
                        <option value="N">Nocturna</option>
                      </select>
                    </div>
                    <div class="form-group col-md-4">
                      <label>N¬∞ Sorteo</label>
                      <input type="text" id="extracto-sorteo-manual" class="form-control" placeholder="Opcional">
                    </div>
                  </div>

                  <h5 class="mt-3">N√∫meros (20 posiciones)</h5>
                  <div class="numeros-grid" id="extracto-numeros-manual"></div>

                  <div id="letras-container-manual">
                    <h5>Letras</h5>
                    <div class="letras-grid" id="extracto-letras-manual"></div>
                  </div>

                  <div class="form-actions mt-3">
                    <button class="btn btn-secondary" onclick="limpiarExtractoManual()">Limpiar</button>
                    <button class="btn btn-primary" onclick="guardarExtractoManual()">
                      <i class="fas fa-save"></i> Agregar a Pendientes
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Extractos Cargados (para agregar) -->
            <div class="mt-4" id="extractos-pendientes-container" style="display: none;">
              <h4><i class="fas fa-list"></i> Extractos a guardar</h4>
              <div id="extractos-pendientes-list"></div>
              <div class="form-actions mt-3">
                <button class="btn btn-success btn-lg" onclick="guardarExtractosPendientes()">
                  <i class="fas fa-save"></i> Guardar Todos los Extractos
                </button>
                <button class="btn btn-secondary" onclick="limpiarExtractosPendientes()">
                  <i class="fas fa-trash"></i> Limpiar
                </button>
              </div>
            </div>
          </div>

          <!-- SECCI√ìN DE CONFIG OCR ELIMINADA (API KEY EST√Å EN config.js) -->

          <div class="tab-content hidden" id="tab-ver">
            <!-- Filtros -->
            <div class="row g-3 align-items-end mb-4">
              <div class="col-md-2">
                <label class="form-label">Fecha</label>
                <input type="date" class="form-control" id="extractos-fecha">
              </div>
              <div class="col-md-2">
                <label class="form-label">Juego</label>
                <select class="form-control" id="extractos-filtro-juego">
                  <option value="">Todos</option>
                  <option value="quiniela">Quiniela</option>
                  <option value="poceada">Poceada</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Modalidad</label>
                <select class="form-control" id="extractos-filtro-modalidad">
                  <option value="">Todas</option>
                  <option value="R">Previa</option>
                  <option value="P">Primera</option>
                  <option value="M">Matutina</option>
                  <option value="V">Vespertina</option>
                  <option value="N">Nocturna</option>
                </select>
              </div>
              <div class="col-md-2">
                <button class="btn btn-primary w-100" onclick="buscarExtractos()">
                  <i class="fas fa-search"></i> Buscar
                </button>
              </div>
              <div class="col-md-2">
                <button class="btn btn-success w-100" onclick="descargarExtractosExcel()" id="btn-descargar-extractos"
                  disabled>
                  <i class="fas fa-file-excel"></i> Descargar Excel
                </button>
              </div>
            </div>

            <!-- Resultados -->
            <div id="extractos-resultados">
              <div class="text-center text-muted py-4">
                <i class="fas fa-search fa-3x mb-3"></i>
                <p>Seleccion√° una fecha y hac√© clic en Buscar para ver los extractos</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Agencias -->
      <section id="view-agencias" class="view hidden">
        <div class="page-header">
          <div>
            <h1>Agencias</h1>
            <p>Gesti√≥n de cuentas corrientes y agencias</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Cargar Excel de Agencias</h3>
          </div>
          <div class="card-body">
            <div class="form-group">
              <label>Archivo Excel (.xlsx, .xls)</label>
              <div class="file-upload-area" id="agencias-upload-area">
                <input type="file" id="agencias-excel-input" accept=".xlsx,.xls" class="hidden"
                  onchange="cargarExcelAgencias()">
                <div class="file-upload-content">
                  <i class="fas fa-file-excel fa-3x"></i>
                  <p>Arrastr√° el archivo Excel aqu√≠ o hac√© click para seleccionar</p>
                  <p class="text-muted">Formato: Columna A = N√∫mero completo, Columna C = Nombre, etc.</p>
                </div>
              </div>

              <div class="form-check mt-3" style="margin-top: 1rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                  <input type="checkbox" id="agencias-reemplazar" checked>
                  <span class="text-danger"><i class="fas fa-trash-alt"></i> Borrar agencias actuales y reemplazar con
                    este Excel</span>
                </label>
              </div>
            </div>

            <div id="agencias-carga-resultado" class="hidden"></div>

            <div class="form-actions">
              <button class="btn btn-primary" onclick="document.getElementById('agencias-excel-input').click()">
                <i class="fas fa-upload"></i> Seleccionar Excel
              </button>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top: 1.5rem;">
          <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3>Listado de Agencias</h3>
            <div style="display: flex; gap: 1rem; align-items: center;">
              <input type="text" id="agencias-buscar" class="form-control"
                placeholder="Buscar por nombre, barrio, cuenta..." style="width: 300px;" onkeyup="filtrarAgencias()">
              <button class="btn btn-secondary" onclick="cargarListaAgencias()">
                <i class="fas fa-sync-alt"></i> Actualizar
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="agencias-loading" class="text-center hidden">
              <i class="fas fa-spinner fa-spin"></i> Cargando agencias...
            </div>

            <div id="agencias-tabla-container">
              <table class="table" id="agencias-tabla">
                <thead>
                  <tr>
                    <th>Prov</th>
                    <th>Cta Cte</th>
                    <th>DV</th>
                    <th>Titular</th>
                    <th>Direcci√≥n</th>
                    <th>Barrio / Localidad</th>
                    <th>Email</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="agencias-tabla-body">
                  <tr>
                    <td colspan="8" class="text-center text-muted">
                      <i class="fas fa-info-circle"></i> Hac√© click en "Actualizar" para cargar las agencias
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div id="agencias-paginacion" class="pagination-container hidden"></div>
          </div>
        </div>
      </section>

      <!-- Control Previo -->
      <section id="view-control-previo" class="view hidden">
        <div class="page-header">
          <div>
            <h1 id="cp-titulo">Control Previo</h1>
            <p id="cp-subtitulo">Procesamiento y validaci√≥n de archivos NTF</p>
          </div>
        </div>

        <!-- Carga de archivo -->
        <div class="card">
          <div class="card-header d-flex" style="justify-content: space-between; align-items: center;">
            <h3>Cargar Archivo ZIP</h3>
            <span class="badge" id="cp-juego-detectado"></span>
          </div>

          <div class="upload-area" id="cp-upload-area">
            <i class="fas fa-file-archive"></i>
            <p>Arrastre el archivo ZIP aqu√≠ o haga clic para seleccionar</p>
            <span id="cp-upload-hint">Ej: QNLxxxxxx.zip, PCDxxxxxx.zip o LTOxxxxxx.zip</span>
            <input type="file" id="cp-archivo-input" accept=".zip" hidden>
          </div>

          <div id="cp-archivo-seleccionado" class="hidden"
            style="margin: 1rem 0; padding: 1rem; background: var(--bg-input); border-radius: 8px;">
            <div class="d-flex" style="justify-content: space-between; align-items: center;">
              <div>
                <i class="fas fa-file-archive" style="color: var(--primary); margin-right: 0.5rem;"></i>
                <span id="cp-archivo-nombre"></span>
              </div>
              <button class="btn btn-primary" onclick="procesarControlPrevio()">
                <i class="fas fa-cogs"></i> Procesar
              </button>
            </div>
          </div>
        </div>

        <!-- Pozo de Arrastre (Solo Poceada) -->
        <div id="cp-poceada-especifico" class="card hidden" style="border-left: 5px solid var(--primary);">
          <div class="card-body">
            <div
              style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
              <div>
                <h4>Pozos de Arrastre</h4>
                <p class="text-muted">Acumulados del sorteo anterior</p>
              </div>
              <div style="text-align: right;">
                <button class="btn btn-sm btn-primary" onclick="abrirModalPozosArrastre()" style="margin-bottom: 5px;">
                  <i class="fas fa-edit"></i> Cargar / Corregir Arrastres
                </button>
              </div>
            </div>
            <div id="cp-pozos-arrastre-grid"
              style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.8rem; margin-top: 0.8rem;">
              <div style="background: var(--bg-input); border-radius: 8px; padding: 0.8rem; text-align: center;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.3rem;"><i
                    class="fas fa-medal" style="color: gold;"></i> 1er Premio</div>
                <div id="cp-pozo-arrastre-1er" style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">$0
                </div>
              </div>
              <div style="background: var(--bg-input); border-radius: 8px; padding: 0.8rem; text-align: center;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.3rem;"><i
                    class="fas fa-medal" style="color: silver;"></i> 2do Premio</div>
                <div id="cp-pozo-arrastre-2do" style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">$0
                </div>
              </div>
              <div style="background: var(--bg-input); border-radius: 8px; padding: 0.8rem; text-align: center;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.3rem;"><i
                    class="fas fa-medal" style="color: #cd7f32;"></i> 3er Premio</div>
                <div id="cp-pozo-arrastre-3er" style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">$0
                </div>
              </div>
              <div style="background: var(--bg-input); border-radius: 8px; padding: 0.8rem; text-align: center;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.3rem;"><i
                    class="fas fa-user-tie" style="color: var(--info-color);"></i> Agenciero</div>
                <div id="cp-pozo-arrastre-agenciero"
                  style="font-size: 1.3rem; font-weight: bold; color: var(--primary);">$0</div>
              </div>
            </div>
            <div id="cp-pozos-arrastre-fuente" style="margin-top: 0.5rem; text-align: right;">
              <small class="text-muted" id="cp-pozos-fuente-texto"></small>
            </div>
          </div>
        </div>

        <!-- Loto: Modalidades con premios completos -->
        <div id="cp-loto-modalidades" class="card hidden" style="border-left: 5px solid var(--warning);">
          <div class="card-header">
            <h3><i class="fas fa-layer-group"></i> Desglose por Modalidad - LOTO</h3>
            <span class="badge badge-warning">Memorando</span>
          </div>
          <div class="table-container" style="overflow-x: auto;">
            <table class="table" style="min-width: 1000px;">
              <thead>
                <tr>
                  <th>Modalidad</th>
                  <th>Registros</th>
                  <th>Apuestas</th>
                  <th>Recaudaci√≥n</th>
                  <th>Premio 6 Ac</th>
                  <th>Premio 5 Ac</th>
                  <th>Premio 4 Ac</th>
                  <th>Agenciero</th>
                  <th>Fondo</th>
                  <th>Pozo Vacante</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Loto: Comparaci√≥n Pozos Vacantes y Arrastres -->
        <div id="cp-loto-pozos" class="card hidden" style="border-left: 5px solid var(--danger);">
          <div class="card-header">
            <h3><i class="fas fa-coins"></i> Pozos Vacantes y Arrastres - LOTO</h3>
            <span class="badge badge-danger">Comparaci√≥n XML</span>
          </div>
          <div class="table-container" style="overflow-x: auto;">
            <table class="table" style="min-width: 800px;">
              <thead>
                <tr>
                  <th>Modalidad</th>
                  <th>Premio</th>
                  <th>Monto Calculado</th>
                  <th>Pozo Vacante</th>
                  <th>Pozo a Asegurar</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="cp-loto-pozos-body"></tbody>
            </table>
          </div>
        </div>

        <!-- Resultados -->
        <div id="cp-resultados" class="hidden">

          <!-- Resumen -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon blue"><i class="fas fa-ticket-alt"></i></div>
              <div class="stat-value" id="cp-tickets-total">0</div>
              <div class="stat-label">Tickets (Total)</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
              <div class="stat-value" id="cp-registros">0</div>
              <div class="stat-label">Tickets V√°lidos</div>
            </div>
            <div class="stat-card" style="padding: 1rem;">
              <div class="stat-icon" style="background: rgba(239, 68, 68, 0.2); color: var(--danger);"><i
                  class="fas fa-ban"></i></div>
              <div class="stat-value" id="cp-anulados" style="font-size: 1.5rem;">0</div>
              <div class="stat-label">Anulados</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon purple"><i class="fas fa-layer-group"></i></div>
              <div class="stat-value" id="cp-apuestas">0</div>
              <div class="stat-label">Apuestas Totales</div>
            </div>
            <div class="stat-card" style="grid-column: span 1;">
              <div class="stat-icon orange"><i class="fas fa-dollar-sign"></i></div>
              <div class="stat-value" id="cp-recaudacion"
                style="font-size: clamp(1rem, 3vw, 1.8rem); word-break: break-word;">$0</div>
              <div class="stat-label">Recaudaci√≥n V√°lida</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);"><i
                  class="fas fa-times-circle"></i></div>
              <div class="stat-value" id="cp-recaudacion-anulada">$0</div>
              <div class="stat-label">Recaudaci√≥n Anulada</div>
            </div>
          </div>

          <!-- Desglose por Provincia (Unificado) -->
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-map-marker-alt"></i> Desglose por Provincia</h3>
              <span class="badge badge-info" id="cp-sorteo-badge">Sorteo: -</span>
            </div>
            <div class="table-container">
              <table class="table" id="cp-tabla-recaudacion-prov">
                <thead>
                  <tr>
                    <th>Provincia</th>
                    <th>Recaudaci√≥n</th>
                    <th>% Rec.</th>
                    <th>Apuestas</th>
                    <th>% Ap.</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <!-- Tabla oculta para compatibilidad -->
          <table class="table hidden" id="cp-tabla-provincias" style="display:none;"><tbody></tbody></table>

          <!-- Comparaci√≥n con XML -->
          <div class="card">
            <div class="card-header">
              <h3>Comparaci√≥n con Datos Oficiales (UTE)</h3>
              <span id="cp-verificacion-badge"></span>
            </div>
            <div class="table-container">
              <table class="table">
                <thead>
                  <tr>
                    <th>Concepto</th>
                    <th>Calculado (TXT)</th>
                    <th>Oficial (XML)</th>
                    <th>Diferencia</th>
                  </tr>
                </thead>
                <tbody id="cp-tabla-comparacion"></tbody>
              </table>
            </div>
          </div>

          <!-- Desglose por Tipo de Apuesta (Solo Tombolina) -->
          <div class="card hidden" id="cp-tombolina-desglose-card">
            <div class="card-header">
              <h3><i class="fas fa-dice"></i> Desglose por Tipo de Apuesta</h3>
              <span class="badge badge-primary">Tombolina</span>
            </div>
            <div class="table-container">
              <table class="table">
                <thead>
                  <tr>
                    <th>Tipo de Apuesta</th>
                    <th>Apuestas V√°lidas</th>
                    <th>Recaudaci√≥n</th>
                    <th>% del Total</th>
                    <th>Apuestas Anuladas</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody id="cp-tombolina-desglose-body"></tbody>
                <tfoot>
                  <tr style="font-weight: bold; background: var(--bg-card-hover);">
                    <td>Total</td>
                    <td id="cp-tmb-total-validas">0</td>
                    <td id="cp-tmb-total-recaudacion">$0</td>
                    <td>100%</td>
                    <td id="cp-tmb-total-anuladas">0</td>
                    <td id="cp-tmb-total-general">0</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- Comparaci√≥n de Premios (Solo Poceada) -->
          <div class="card hidden" id="cp-comparacion-premios-card">
            <div class="card-header">
              <h3>üìä Comparaci√≥n de Premios</h3>
              <span class="badge badge-info" id="cp-config-version"></span>
            </div>
            <div class="table-container">
              <table class="table">
                <thead>
                  <tr>
                    <th>Premio</th>
                    <th>Porcentaje</th>
                    <th>Calculado</th>
                    <th>Oficial (XML)</th>
                    <th>Diferencia</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody id="cp-tabla-premios"></tbody>
              </table>
            </div>
            <div class="card-body" style="padding-top: 0;">
              <small class="text-muted">
                <strong>Leyenda:</strong>
                <span style="color: var(--success-color);">‚úÖ OK</span> = Sin diferencia |
                <span style="color: var(--warning-color);">‚ö†Ô∏è Revisar</span> = Diferencia menor |
                <span style="color: var(--danger-color);">‚ùå Error</span> = Diferencia significativa
              </small>
            </div>
          </div>

          <!-- Distribuci√≥n de Premios (Solo Poceada) -->
          <div class="card hidden" id="cp-distribucion-premios-card">
            <div class="card-header">
              <h3>üí∞ Distribuci√≥n de Premios Calculada</h3>
              <span class="badge" id="cp-pozo-asegurado-badge" style="background: var(--accent-color);">Pozo Asegurado:
                -</span>
            </div>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="cp-premio-1ro">$0</div>
                <div class="stat-label">1er Premio (8 aciertos)</div>
                <small id="cp-premio-1ro-arrastre" class="text-muted"></small>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-premio-2do">$0</div>
                <div class="stat-label">2do Premio (7 aciertos)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-premio-3ro">$0</div>
                <div class="stat-label">3er Premio (6 aciertos)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-premio-agenciero">$0</div>
                <div class="stat-label">Premio Agenciero</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-fondo-reserva">$0</div>
                <div class="stat-label">Fondo de Reserva</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-total-premios">$0</div>
                <div class="stat-label">Total Premios (45%)</div>
              </div>
            </div>
          </div>

          <!-- Verificaci√≥n de Seguridad -->
          <div class="card">
            <div class="card-header">
              <h3>Verificaci√≥n de Seguridad</h3>
            </div>
            <div id="cp-seguridad-content"></div>
          </div>

          <!-- NUEVO: Validaci√≥n contra Programaci√≥n -->
          <div class="card hidden" id="cp-validacion-programacion">
            <div class="card-header">
              <h3><i class="fas fa-calendar-check"></i> Validaci√≥n contra Programaci√≥n</h3>
              <span class="badge badge-info" id="cp-modalidad-badge">Sin Modalidad</span>
            </div>
            <div class="card-body">
              <div id="cp-validacion-estado" style="margin-bottom: 1rem;">
                <!-- Estado general de validaci√≥n -->
              </div>
              <table class="data-table" id="cp-tabla-validacion-provincias">
                <thead>
                  <tr>
                    <th>Provincia</th>
                    <th>Programada</th>
                    <th>Apuestas</th>
                    <th>Recaudaci√≥n</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div id="cp-validacion-errores" class="hidden" style="margin-top: 1rem;"></div>
              <div id="cp-validacion-warnings" class="hidden" style="margin-top: 0.5rem;"></div>
            </div>
          </div>

          <!-- Resumen de Agencias Amigas -->
          <div class="card hidden" id="cp-agencias-amigas-resumen">
            <div class="card-body">
              <!-- Se llena din√°micamente -->
            </div>
          </div>

          <!-- Errores de Agencias Amigas -->
          <div class="card hidden" id="cp-errores-agencias-amigas">
            <div class="card-header">
              <h3>Errores de Agencias Amigas</h3>
            </div>
            <div class="card-body">
              <!-- Se llena din√°micamente -->
            </div>
          </div>

          <!-- Online -->
          <div class="card">
            <div class="card-header">
              <h3 id="cp-online-titulo">Quiniela Online (Agencia 88880)</h3>
            </div>
            <div class="stats-grid" style="margin-bottom: 0;">
              <div class="stat-card">
                <div class="stat-value" id="cp-online-registros">0</div>
                <div class="stat-label">Registros</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-online-apuestas">0</div>
                <div class="stat-label">Apuestas</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-online-recaudacion">$0</div>
                <div class="stat-label">Recaudaci√≥n</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="cp-online-anulados">0</div>
                <div class="stat-label">Anulados</div>
              </div>
            </div>
          </div>

          <!-- Acciones -->
          <div class="card">
            <div class="form-actions" style="border: none; padding: 0; margin: 0;">
              <button class="btn btn-secondary" onclick="limpiarControlPrevio()">
                <i class="fas fa-trash"></i> Limpiar
              </button>
              <button class="btn btn-success" onclick="guardarControlPrevio()">
                <i class="fas fa-save"></i> Guardar en BD
              </button>
              <button class="btn btn-info" onclick="imprimirReporteCP()">
                <i class="fas fa-print"></i> Imprimir Reporte
              </button>
              <button class="btn btn-primary" onclick="generarActaControlPrevio()">
                <i class="fas fa-file-signature"></i> Generar Acta Notarial
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Control Posterior -->
      <section id="view-control-posterior" class="view hidden">
        <div class="page-header">
          <h1 id="cpst-titulo">Control Posterior</h1>
          <p id="cpst-subtitulo">An√°lisis de ganadores post-sorteo</p>
        </div>

        <!-- Selecci√≥n de Juego -->
        <div class="card" style="border-left: 4px solid var(--primary);">
          <div class="card-header">
            <h3><i class="fas fa-gamepad"></i> Seleccionar Juego</h3>
          </div>
          <div class="card-body">
            <div class="form-row"
              style="display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 0.75rem; padding-bottom: 0.5rem; -webkit-overflow-scrolling: touch;">
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card"
                  style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                  onclick="seleccionarJuegoPosterior('Quiniela')">
                  <input type="radio" name="cpst-juego" value="Quiniela" checked style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">üé± Quiniela</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">20 n√∫meros</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card"
                  style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                  onclick="seleccionarJuegoPosterior('Poceada')">
                  <input type="radio" name="cpst-juego" value="Poceada" style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">üéØ Poceada</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">8 n√∫m + 4 let</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card"
                  style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                  onclick="seleccionarJuegoPosterior('Tombolina')">
                  <input type="radio" name="cpst-juego" value="Tombolina" style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">üé∞ Tombolina</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">Sobre Quiniela</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card"
                  style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                  onclick="seleccionarJuegoPosterior('Quini 6')">
                  <input type="radio" name="cpst-juego" value="Quini 6" style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">‚ú® Quini 6</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">6/45 Tradicional</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card"
                  style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                  onclick="seleccionarJuegoPosterior('Brinco')">
                  <input type="radio" name="cpst-juego" value="Brinco" style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">üíé Brinco</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">6/40 Trad/Jun</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card"
                  style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;"
                  onclick="seleccionarJuegoPosterior('Loto 5')">
                  <input type="radio" name="cpst-juego" value="Loto 5" style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">üñêÔ∏è Loto 5</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">5/36 Plus</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 0 0 auto; min-width: 180px;">
                <label class="radio-card" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.2s;" onclick="seleccionarJuegoPosterior('Loto')">
                  <input type="radio" name="cpst-juego" value="Loto" style="width: 18px; height: 18px;">
                  <div>
                    <strong style="font-size: 0.95rem;">üçÄ Loto</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.7rem;">6/45 + PLUS</p>
                  </div>
                </label>
              </div>
            </div>


          </div>
        </div>

        <!-- Paso 1: Cargar datos -->
        <div class="card">
          <div class="card-header">
            <h3>1. Datos del Sorteo</h3>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Usar datos de Control Previo</label>
              <button class="btn btn-secondary" onclick="cargarDatosControlPrevio()" id="btn-cargar-cp">
                <i class="fas fa-download"></i> Cargar desde Control Previo
              </button>
            </div>
            <div class="form-group">
              <label>O subir archivo ZIP</label>
              <input type="file" id="cpst-archivo-zip" accept=".zip" class="form-control"
                onchange="cargarZipPosterior(this)">
            </div>
          </div>

          <div id="cpst-datos-cargados" class="hidden"
            style="margin-top: 1rem; padding: 1rem; background: var(--bg-input); border-radius: 8px;">
            <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
              <span><strong>Sorteo:</strong> <span id="cpst-sorteo">-</span></span>
              <span><strong>Juego:</strong> <span id="cpst-juego-badge" class="badge badge-primary">-</span></span>
              <span><strong>Modalidad:</strong> <span id="cpst-modalidad-badge" class="badge">-</span></span>
              <span><strong>Registros:</strong> <span id="cpst-registros">0</span></span>
              <span><strong>Recaudaci√≥n:</strong> <span id="cpst-recaudacion">$0</span></span>
            </div>
            <small class="text-muted" style="display: block; margin-top: 0.5rem;" id="cpst-hint-modalidad">
              üí° Al cargar XMLs, solo se procesar√°n los de la modalidad detectada
            </small>
          </div>

          <!-- NUEVO: Validaci√≥n de Programaci√≥n -->
          <div id="cpst-validacion-programacion" class="hidden" style="margin-top: 1rem;">
            <div class="card" style="background: var(--bg-input); border: 1px solid var(--border-color);">
              <h4 style="margin-bottom: 1rem;"><i class="fas fa-clipboard-check"></i> Validaci√≥n contra Programaci√≥n
              </h4>

              <!-- Estado de validaci√≥n -->
              <div id="cpst-validacion-estado" style="margin-bottom: 1rem;"></div>

              <!-- Tabla de provincias -->
              <div class="table-responsive">
                <table class="table" id="cpst-tabla-validacion-provincias">
                  <thead>
                    <tr>
                      <th>Provincia</th>
                      <th>Programada</th>
                      <th>Apuestas</th>
                      <th>Recaudaci√≥n</th>
                      <th>Estado</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

              <!-- Errores y Warnings -->
              <div id="cpst-validacion-errores" class="hidden" style="margin-top: 1rem;"></div>
              <div id="cpst-validacion-warnings" class="hidden" style="margin-top: 1rem;"></div>
            </div>
          </div>
        </div>

        <!-- Paso 2: Cargar Extractos - ZONA INTELIGENTE UNIFICADA -->
        <div class="card" id="cpst-extracto-quiniela-card">
          <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3><i class="fas fa-magic"></i> 2. Extractos</h3>
            <button class="btn btn-sm btn-secondary" onclick="toggleModoManual()" id="btn-modo-manual">
              <i class="fas fa-keyboard"></i> Modo Manual
            </button>
          </div>

          <!-- ZONA DE CARGA INTELIGENTE -->
          <div id="cpst-zona-inteligente">
            <div id="cpst-dropzone" class="dropzone-inteligente"
              onclick="document.getElementById('cpst-archivo-universal').click()" ondragover="handleDragOver(event)"
              ondragleave="handleDragLeave(event)" ondrop="handleDropInteligente(event)">
              <div class="dropzone-content">
                <i class="fas fa-cloud-upload-alt"
                  style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                <h4 style="margin: 0 0 0.5rem 0;">Arrastr√° tus archivos aqu√≠</h4>
                <p class="text-muted" style="margin: 0;">
                  <strong>XML</strong>, <strong>Im√°genes</strong> (JPG, PNG) o <strong>PDF</strong><br>
                  <small>El sistema detecta autom√°ticamente provincia y modalidad</small>
                </p>
                <button class="btn btn-primary" style="margin-top: 1rem;"
                  onclick="event.stopPropagation(); document.getElementById('cpst-archivo-universal').click()">
                  <i class="fas fa-folder-open"></i> Seleccionar Archivos
                </button>
              </div>
              <input type="file" id="cpst-archivo-universal" accept=".xml,.jpg,.jpeg,.png,.gif,.webp,.pdf" multiple
                hidden onchange="procesarArchivosInteligente(this.files)">
            </div>

            <!-- Estado de procesamiento -->
            <div id="cpst-procesamiento-status" class="hidden" style="margin-top: 1rem;">
              <div class="procesamiento-card">
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: var(--primary);"></i>
                  <div style="flex: 1;">
                    <div id="cpst-procesamiento-mensaje">Procesando archivos...</div>
                    <div class="progress-bar"
                      style="margin-top: 0.5rem; height: 6px; background: var(--border-color); border-radius: 3px;">
                      <div id="cpst-procesamiento-progress"
                        style="height: 100%; width: 0%; background: var(--primary); border-radius: 3px; transition: width 0.3s;">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- MODO MANUAL (oculto por defecto) -->
          <div id="cpst-modo-manual" class="hidden">
            <div class="form-row" style="margin-bottom: 1rem;">
              <div class="form-group" style="flex: 1;">
                <label for="cpst-extracto-provincia">Provincia</label>
                <select id="cpst-extracto-provincia" class="form-control">
                  <option value="0">CABA</option>
                  <option value="1">Buenos Aires</option>
                  <option value="2">C√≥rdoba</option>
                  <option value="3">Santa Fe</option>
                  <option value="4">Montevideo</option>
                  <option value="5">Mendoza</option>
                  <option value="6">Entre R√≠os</option>
                </select>
              </div>
            </div>

            <div style="margin-top: 1rem;">
              <label>N√∫meros (20 posiciones)</label>
              <div class="numeros-grid" id="cpst-numeros-grid"></div>
            </div>

            <div style="margin-top: 1rem;">
              <label>Letras (4)</label>
              <div class="letras-grid" id="cpst-letras-grid"></div>
            </div>

            <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
              <button class="btn btn-primary" onclick="agregarExtractoManual()">
                <i class="fas fa-plus"></i> Agregar Extracto
              </button>
              <button class="btn btn-secondary" onclick="limpiarExtractoPosterior()">
                <i class="fas fa-eraser"></i> Limpiar
              </button>
            </div>
          </div>

          <!-- Lista de extractos cargados -->
          <div id="cpst-extractos-lista" style="margin-top: 1.5rem;"></div>
        </div>

        <!-- Paso 2: Cargar Extracto (POCEADA) - Oculto por defecto -->
        <div class="card hidden" id="cpst-extracto-poceada-card">
          <div class="card-header">
            <h3>2. Extracto Poceada (20 N√∫meros + 4 Letras del Sorteo)</h3>
          </div>

          <div class="tabs-container" style="margin-top: 1rem;">
            <div class="tabs" style="display: flex; gap: 0; border-bottom: 2px solid var(--border-color);">
              <button class="tab active" data-tab="poc-ext-xml" onclick="cambiarTabExtractoPoceada('xml')">
                <i class="fas fa-file-code"></i> XML
              </button>
              <button class="tab" data-tab="poc-ext-manual" onclick="cambiarTabExtractoPoceada('manual')">
                <i class="fas fa-keyboard"></i> Manual
              </button>
            </div>

            <!-- Tab XML Poceada -->
            <div class="tab-content" id="tab-poc-ext-xml">
              <div style="margin-top: 1rem;">
                <label>Cargar archivo XML del extracto</label>
                <input type="file" id="cpst-poceada-extracto-xml" accept=".xml" class="form-control"
                  onchange="cargarExtractoPoceadaXML(this)">
                <small class="text-muted">
                  XML del extracto oficial de Poceada con los 20 n√∫meros y 4 letras del sorteo
                </small>
              </div>
              <div style="margin-top: 1rem;">
                <label>O pegar XML directamente</label>
                <textarea id="cpst-poceada-xml-texto" class="form-control" rows="4"
                  placeholder="<extracto>...</extracto>"></textarea>
                <button class="btn btn-secondary" style="margin-top: 0.5rem;"
                  onclick="cargarExtractoPoceadaDesdeTextoXML()">
                  <i class="fas fa-check"></i> Cargar XML
                </button>
              </div>
            </div>

            <!-- Tab Manual Poceada -->
            <div class="tab-content hidden" id="tab-poc-ext-manual">
              <div style="margin-top: 1rem;">
                <label style="margin-bottom: 0.5rem; display: block;">
                  <strong>20 N√∫meros del Sorteo</strong> (00-99)
                </label>
                <div style="display: grid; grid-template-columns: repeat(10, 1fr); gap: 0.5rem; max-width: 600px;"
                  id="cpst-poceada-numeros-grid">
                  <!-- Los 20 inputs se generan din√°micamente -->
                </div>
                <small class="text-muted" style="display: block; margin-top: 0.5rem;">
                  Ingrese los 20 n√∫meros sorteados. Los jugadores ganan si sus 8 n√∫meros elegidos est√°n entre estos 20.
                </small>
              </div>

              <div style="margin-top: 1.5rem;">
                <label style="margin-bottom: 0.5rem; display: block;">
                  <strong>4 Letras Ganadoras</strong> (A-P)
                </label>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; max-width: 300px;"
                  id="cpst-poceada-letras-grid">
                  <div class="form-group" style="margin: 0;">
                    <label style="font-size: 0.75rem; text-align: center; display: block;">1¬∞</label>
                    <input type="text" maxlength="1" class="form-control text-center poceada-letra" placeholder="A"
                      style="font-weight: bold; text-transform: uppercase;">
                  </div>
                  <div class="form-group" style="margin: 0;">
                    <label style="font-size: 0.75rem; text-align: center; display: block;">2¬∞</label>
                    <input type="text" maxlength="1" class="form-control text-center poceada-letra" placeholder="B"
                      style="font-weight: bold; text-transform: uppercase;">
                  </div>
                  <div class="form-group" style="margin: 0;">
                    <label style="font-size: 0.75rem; text-align: center; display: block;">3¬∞</label>
                    <input type="text" maxlength="1" class="form-control text-center poceada-letra" placeholder="C"
                      style="font-weight: bold; text-transform: uppercase;">
                  </div>
                  <div class="form-group" style="margin: 0;">
                    <label style="font-size: 0.75rem; text-align: center; display: block;">4¬∞</label>
                    <input type="text" maxlength="1" class="form-control text-center poceada-letra" placeholder="D"
                      style="font-weight: bold; text-transform: uppercase;">
                  </div>
                </div>
                <small class="text-muted" style="display: block; margin-top: 0.5rem;">
                  Letras v√°lidas: A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P
                </small>
              </div>
            </div>
          </div>

          <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-input); border-radius: 8px;"
            id="cpst-poceada-extracto-preview" class="hidden">
            <h4 style="margin-bottom: 1rem;"><i class="fas fa-check-circle text-success"></i> Extracto Cargado</h4>
            <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
              <div>
                <strong>N√∫meros:</strong>
                <span id="cpst-poceada-numeros-preview" style="font-family: monospace; font-size: 1.1rem;">-</span>
              </div>
              <div>
                <strong>Letras:</strong>
                <span id="cpst-poceada-letras-preview" style="font-family: monospace; font-size: 1.1rem;">-</span>
              </div>
            </div>
          </div>

          <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <button class="btn btn-primary" onclick="confirmarExtractoPoceada()">
              <i class="fas fa-check"></i> Confirmar Extracto
            </button>
            <button class="btn btn-secondary" onclick="limpiarExtractoPoceada()">
              <i class="fas fa-eraser"></i> Limpiar
            </button>
          </div>
        </div>

        <!-- Extracto Loto -->
        <div class="card hidden" id="cpst-extracto-loto-card">
          <div class="card-header">
            <h3>2. Extracto Loto (4 Modalidades x 6 N√∫meros + PLUS)</h3>
          </div>

          <!-- Zona de Drop para XML -->
          <div id="cpst-loto-xml-dropzone" class="file-drop-zone" 
               style="margin-bottom: 1rem; padding: 1.5rem; border: 2px dashed var(--warning); border-radius: 8px; text-align: center; cursor: pointer; background: rgba(245, 158, 11, 0.05);"
               ondragover="event.preventDefault(); this.classList.add('drag-over');"
               ondragleave="this.classList.remove('drag-over');"
               ondrop="event.preventDefault(); this.classList.remove('drag-over'); cargarXMLExtractoLoto(event.dataTransfer.files[0]);">
            <i class="fas fa-file-code fa-2x text-warning mb-2"></i>
            <p style="margin: 0.5rem 0;"><strong>Arrastr√° el XML del extracto aqu√≠</strong></p>
            <p class="text-muted" style="font-size: 0.85rem; margin: 0;">o hac√© click para seleccionar</p>
            <input type="file" id="cpst-loto-xml-input" accept=".xml" style="display: none;" onchange="cargarXMLExtractoLoto(this.files[0]);">
          </div>
          <div id="cpst-loto-xml-info" class="hidden" style="margin-bottom: 1rem; padding: 0.75rem; background: var(--success-bg); border-radius: 8px; border-left: 4px solid var(--success);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span><i class="fas fa-check-circle text-success"></i> <strong id="cpst-loto-xml-filename">archivo.xml</strong> cargado</span>
              <button class="btn btn-sm btn-outline" onclick="limpiarXMLExtractoLoto()"><i class="fas fa-times"></i></button>
            </div>
          </div>

          <div style="text-align: center; margin: 0.5rem 0; color: var(--text-muted);">
            <small>‚îÄ‚îÄ‚îÄ o ingres√° los n√∫meros manualmente ‚îÄ‚îÄ‚îÄ</small>
          </div>

          <!-- Tradicional -->
          <div style="margin-top: 1rem; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; border-left: 4px solid var(--warning);">
            <label style="margin-bottom: 0.5rem; display: block;">
              <strong><span class="badge badge-warning">Tradicional</span></strong> 6 N√∫meros (0-45)
            </label>
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; max-width: 450px;">
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">1¬∞</label><input type="number" id="cpst-loto-trad-1" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">2¬∞</label><input type="number" id="cpst-loto-trad-2" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">3¬∞</label><input type="number" id="cpst-loto-trad-3" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">4¬∞</label><input type="number" id="cpst-loto-trad-4" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">5¬∞</label><input type="number" id="cpst-loto-trad-5" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">6¬∞</label><input type="number" id="cpst-loto-trad-6" min="0" max="45" class="form-control text-center" placeholder="00"></div>
            </div>
          </div>

          <!-- Match -->
          <div style="margin-top: 0.75rem; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; border-left: 4px solid var(--primary);">
            <label style="margin-bottom: 0.5rem; display: block;">
              <strong><span class="badge badge-primary">Match</span></strong> 6 N√∫meros (0-45)
            </label>
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; max-width: 450px;">
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">1¬∞</label><input type="number" id="cpst-loto-match-1" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">2¬∞</label><input type="number" id="cpst-loto-match-2" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">3¬∞</label><input type="number" id="cpst-loto-match-3" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">4¬∞</label><input type="number" id="cpst-loto-match-4" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">5¬∞</label><input type="number" id="cpst-loto-match-5" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">6¬∞</label><input type="number" id="cpst-loto-match-6" min="0" max="45" class="form-control text-center" placeholder="00"></div>
            </div>
          </div>

          <!-- Desquite -->
          <div style="margin-top: 0.75rem; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; border-left: 4px solid var(--info);">
            <label style="margin-bottom: 0.5rem; display: block;">
              <strong><span class="badge badge-info">Desquite</span></strong> 6 N√∫meros (0-45)
            </label>
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; max-width: 450px;">
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">1¬∞</label><input type="number" id="cpst-loto-desq-1" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">2¬∞</label><input type="number" id="cpst-loto-desq-2" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">3¬∞</label><input type="number" id="cpst-loto-desq-3" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">4¬∞</label><input type="number" id="cpst-loto-desq-4" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">5¬∞</label><input type="number" id="cpst-loto-desq-5" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">6¬∞</label><input type="number" id="cpst-loto-desq-6" min="0" max="45" class="form-control text-center" placeholder="00"></div>
            </div>
          </div>

          <!-- Sale o Sale -->
          <div style="margin-top: 0.75rem; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; border-left: 4px solid var(--success);">
            <label style="margin-bottom: 0.5rem; display: block;">
              <strong><span class="badge badge-success">Sale o Sale</span></strong> 6 N√∫meros (0-45)
            </label>
            <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem; max-width: 450px;">
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">1¬∞</label><input type="number" id="cpst-loto-sos-1" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">2¬∞</label><input type="number" id="cpst-loto-sos-2" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">3¬∞</label><input type="number" id="cpst-loto-sos-3" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">4¬∞</label><input type="number" id="cpst-loto-sos-4" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">5¬∞</label><input type="number" id="cpst-loto-sos-5" min="0" max="45" class="form-control text-center" placeholder="00"></div>
              <div class="form-group" style="margin: 0;"><label style="font-size: 0.75rem; text-align: center; display: block;">6¬∞</label><input type="number" id="cpst-loto-sos-6" min="0" max="45" class="form-control text-center" placeholder="00"></div>
            </div>
          </div>

          <!-- PLUS -->
          <div style="margin-top: 1rem; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; border-left: 4px solid var(--danger);">
            <label style="margin-bottom: 0.5rem; display: block;">
              <strong><span class="badge badge-danger">Multiplicador</span></strong> N√∫mero PLUS (0-9, opcional)
            </label>
            <div style="max-width: 100px;">
              <input type="number" id="cpst-loto-plus" min="0" max="9" class="form-control text-center" placeholder="-">
            </div>
            <small class="text-muted">Si coincide con el PLUS del apostador, el premio se multiplica (x2 extra)</small>
          </div>

          <!-- Premios del XML (read-only, se cargan autom√°ticamente del Control Previo) -->
          <div id="cpst-loto-premios-xml" class="hidden" style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-input); border-radius: 8px; border-left: 3px solid var(--success);">
            <h4 style="margin-bottom: 0.5rem;"><i class="fas fa-file-code text-success"></i> Premios del XML (Control Previo)</h4>
            <div id="cpst-loto-premios-xml-content"></div>
          </div>

          <div id="cpst-loto-preview"></div>

          <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <button class="btn btn-primary" onclick="cargarExtractoLoto();">
              <i class="fas fa-check"></i> Confirmar Extracto
            </button>
          </div>
        </div>

        <!-- Extracto Loto 5 -->
        <div class="card hidden" id="cpst-extracto-loto5-card">
          <div class="card-header">
            <h3>2. Extracto Loto 5 (5 N√∫meros)</h3>
          </div>

          <div style="margin-top: 1rem;">
            <label style="margin-bottom: 0.5rem; display: block;">
              <strong>5 N√∫meros del Sorteo</strong> (0-36)
            </label>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; max-width: 400px;">
              <div class="form-group" style="margin: 0;">
                <label style="font-size: 0.75rem; text-align: center; display: block;">1¬∞</label>
                <input type="number" id="cpst-loto5-num-1" min="0" max="36" class="form-control text-center" placeholder="00">
              </div>
              <div class="form-group" style="margin: 0;">
                <label style="font-size: 0.75rem; text-align: center; display: block;">2¬∞</label>
                <input type="number" id="cpst-loto5-num-2" min="0" max="36" class="form-control text-center" placeholder="00">
              </div>
              <div class="form-group" style="margin: 0;">
                <label style="font-size: 0.75rem; text-align: center; display: block;">3¬∞</label>
                <input type="number" id="cpst-loto5-num-3" min="0" max="36" class="form-control text-center" placeholder="00">
              </div>
              <div class="form-group" style="margin: 0;">
                <label style="font-size: 0.75rem; text-align: center; display: block;">4¬∞</label>
                <input type="number" id="cpst-loto5-num-4" min="0" max="36" class="form-control text-center" placeholder="00">
              </div>
              <div class="form-group" style="margin: 0;">
                <label style="font-size: 0.75rem; text-align: center; display: block;">5¬∞</label>
                <input type="number" id="cpst-loto5-num-5" min="0" max="36" class="form-control text-center" placeholder="00">
              </div>
            </div>
            <small class="text-muted" style="display: block; margin-top: 0.5rem;">
              Rango de n√∫meros: 0 a 36 (37 n√∫meros posibles)
            </small>
          </div>

          <!-- Premios del XML -->
          <div id="cpst-loto5-premios-xml" class="hidden" style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-input); border-radius: 8px; border-left: 3px solid var(--success);">
            <h4 style="margin-bottom: 0.5rem;"><i class="fas fa-file-code text-success"></i> Premios del XML (Control Previo)</h4>
            <div id="cpst-loto5-premios-xml-content"></div>
          </div>

          <div id="cpst-loto5-preview"></div>

          <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <button class="btn btn-primary" onclick="cargarExtractoLoto5();">
              <i class="fas fa-check"></i> Confirmar Extracto
            </button>
          </div>
        </div>

        <!-- Paso 3: Ejecutar Escrutinio -->
        <div class="card">
          <div class="card-header">
            <h3>3. Ejecutar Escrutinio</h3>
          </div>

          <button class="btn btn-primary btn-lg" onclick="ejecutarEscrutinio()" style="width: 100%;">
            <i class="fas fa-calculator"></i> Ejecutar Escrutinio
          </button>
        </div>

        <!-- Resultados -->
        <div id="cpst-resultados" class="hidden">
          <!-- Comparaci√≥n con Control Previo -->
          <div class="card">
            <div class="card-header">
              <h3>Comparaci√≥n con Control Previo</h3>
            </div>
            <table class="table" id="cpst-tabla-comparacion">
              <thead>
                <tr>
                  <th>Concepto</th>
                  <th>Control Previo</th>
                  <th>Control Posterior</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- Resumen de Tickets -->
          <div class="stats-grid" style="margin-bottom: 1rem;">
            <div class="stat-card">
              <div class="stat-icon blue"><i class="fas fa-ticket-alt"></i></div>
              <div class="stat-value" id="cpst-tickets-total">0</div>
              <div class="stat-label">Tickets (Total)</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon green"><i class="fas fa-check-circle"></i></div>
              <div class="stat-value" id="cpst-tickets-validos">0</div>
              <div class="stat-label">Tickets V√°lidos</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(239, 68, 68, 0.2); color: var(--danger);"><i
                  class="fas fa-ban"></i></div>
              <div class="stat-value" id="cpst-tickets-anulados">0</div>
              <div class="stat-label">Anulados</div>
            </div>
          </div>

          <!-- Resumen de Recaudaci√≥n -->
          <div class="stats-grid" id="cpst-recaudacion-grid" style="margin-bottom: 1rem;">
            <div class="stat-card">
              <div class="stat-icon orange"><i class="fas fa-hand-holding-usd"></i></div>
              <div class="stat-value" id="cpst-recaudacion-total">$0</div>
              <div class="stat-label">Recaudaci√≥n (Total)</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon green"><i class="fas fa-check-double"></i></div>
              <div class="stat-value" id="cpst-recaudacion-valida">$0</div>
              <div class="stat-label">Recaudaci√≥n V√°lida</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(239, 68, 68, 0.2); color: var(--danger);"><i
                  class="fas fa-undo"></i></div>
              <div class="stat-value" id="cpst-recaudacion-anulada">$0</div>
              <div class="stat-label">Recaudaci√≥n Anulada</div>
            </div>
          </div>

          <!-- NUEVO: Ventas por Agencia -->
          <div class="card" id="cpst-ventas-agencia-card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3><i class="fas fa-store"></i> Ventas por Agencia</h3>
              <div style="display: flex; gap: 0.5rem;">
                <input type="text" id="cpst-buscar-agencia" class="form-control form-control-sm"
                  placeholder="Filtrar por Agencia/Nombre..." style="width: 200px;"
                  onkeyup="filtrarVentasAgenciaPosterior()">
                <button class="btn btn-sm btn-secondary" onclick="exportarVentasAgenciaPosterior()">
                  <i class="fas fa-file-excel"></i> Excel
                </button>
              </div>
            </div>
            <div class="table-container" style="max-height: 400px; overflow-y: auto;">
              <table class="table" id="cpst-tabla-ventas-agencia">
                <thead>
                  <tr>
                    <th>Prov</th>
                    <th>Agencia / Cta Cte</th>
                    <th>Tickets</th>
                    <th>Apuestas</th>
                    <th>Recaudaci√≥n</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Se llena din√°micamente -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Resumen de Resultados -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon green"><i class="fas fa-trophy"></i></div>
              <div class="stat-value" id="cpst-total-ganadores">0</div>
              <div class="stat-label">Total Ganadores</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon orange"><i class="fas fa-coins"></i></div>
              <div class="stat-value" id="cpst-total-premios">$0</div>
              <div class="stat-label">Total Premios</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon blue"><i class="fas fa-percentage"></i></div>
              <div class="stat-value" id="cpst-tasa-devolucion">0%</div>
              <div class="stat-label">Tasa Devoluci√≥n</div>
            </div>
          </div>

          <!-- Extractos Sorteados (N√∫meros) -->
          <div class="card" id="cpst-extractos-sorteados">
            <div class="card-header">
              <h3><i class="fas fa-dice"></i> Extractos Sorteados</h3>
            </div>
            <div id="cpst-extractos-numeros" style="padding: 1rem;">
              <!-- Se llena din√°micamente con los n√∫meros de cada extracto -->
            </div>
          </div>

          <!-- Detalle por Extracto (QUINIELA) -->
          <div class="card" id="cpst-detalle-quiniela">
            <div class="card-header">
              <h3>Detalle por Extracto - Quiniela</h3>
            </div>
            <div class="table-container">
              <table class="table" id="cpst-tabla-extractos">
                <thead>
                  <tr>
                    <th rowspan="2">Extracto</th>
                    <th rowspan="2">Total Pagado</th>
                    <th rowspan="2">Ganadores</th>
                    <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">1 Cifra</th>
                    <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">2 Cifras</th>
                    <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">3 Cifras</th>
                    <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">4 Cifras</th>
                    <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">Redoblona</th>
                    <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">Letras</th>
                  </tr>
                  <tr>
                    <th>Gan</th>
                    <th>Prem.</th>
                    <th>Gan</th>
                    <th>Prem.</th>
                    <th>Gan</th>
                    <th>Prem.</th>
                    <th>Gan</th>
                    <th>Prem.</th>
                    <th>Gan</th>
                    <th>Prem.</th>
                    <th>Gan</th>
                    <th>Prem.</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <small class="text-muted">Gan = cantidad de registros ganadores | Prem. = monto total premiado</small>
            </div>
          </div>

          <!-- Detalle por Nivel de Aciertos (TOMBOLINA) -->
          <div class="card hidden" id="cpst-detalle-tombolina">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3>Detalle por Nivel de Aciertos - Tombolina</h3>
              <button class="btn btn-primary btn-sm" onclick="imprimirReportePosterior()">
                <i class="fas fa-file-pdf"></i> Imprimir Acta
              </button>
            </div>
            <div class="table-container">
              <table class="table" id="cpst-tabla-tombolina">
                <thead>
                  <tr>
                    <th>Categor√≠a</th>
                    <th>Aciertos</th>
                    <th>Ganadores (Tickets)</th>
                    <th>Nivel Juego</th>
                    <th>Total Pagado</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Se llena din√°micamente -->
                </tbody>
              </table>
            </div>

            <!-- NUEVO: Desglose por Provincia (Tombolina) -->
            <div style="margin-top: 1.5rem;">
              <h4 style="margin-bottom: 1rem;"><i class="fas fa-map-marked-alt"></i> Desglose por Provincia - Tombolina
              </h4>
              <div class="table-container">
                <table class="table" id="cpst-tabla-tombolina-provincias">
                  <thead>
                    <tr>
                      <th rowspan="2">Provincia</th>
                      <th rowspan="2">Total Pagado</th>
                      <th rowspan="2">Ganadores</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">7 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">6 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">5 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">4 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">3 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">Letras</th>
                    </tr>
                    <tr>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Listado de Ganadores (TOMBOLINA) -->
          <div class="card hidden" id="cpst-ganadores-tombolina">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3><i class="fas fa-list"></i> Listado de Tickets Ganadores - Tombolina</h3>
              <button class="btn btn-secondary btn-sm" onclick="exportarGanadoresTombolina()">
                <i class="fas fa-file-excel"></i> Exportar
              </button>
            </div>
            <div class="table-container" style="max-height: 400px; overflow-y: auto;">
              <table class="table" id="cpst-tabla-ganadores-tombolina">
                <thead>
                  <tr>
                    <th>Ticket</th>
                    <th>Agencia</th>
                    <th>Tipo</th>
                    <th>Apostados</th>
                    <th>Aciertos</th>
                    <th>Premio</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Se llena din√°micamente -->
                </tbody>
              </table>
            </div>
          </div>


          <!-- Detalle por Aciertos (POCEADA) -->
          <div class="card hidden" id="cpst-detalle-poceada">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3>Detalle por Nivel de Aciertos - Poceada</h3>
              <button class="btn btn-primary btn-sm" onclick="imprimirReportePosterior()">
                <i class="fas fa-file-pdf"></i> Imprimir Acta
              </button>
            </div>
            <div class="table-container">
              <table class="table" id="cpst-tabla-poceada">
                <thead>
                  <tr>
                    <th>Nivel</th>
                    <th>Aciertos</th>
                    <th>Ganadores</th>
                    <th>Premio por Ganador</th>
                    <th>Total Premios</th>
                    <th>% del Pozo</th>
                    <th>Pozo Vacante</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="nivel-8">
                    <td><span class="badge badge-warning" style="background: gold; color: black;">üèÜ PRIMER
                        PREMIO</span></td>
                    <td><strong>8 aciertos</strong></td>
                    <td id="cpst-poc-gan-8">0</td>
                    <td id="cpst-poc-premio-8">$0</td>
                    <td id="cpst-poc-total-8">$0</td>
                    <td>62%</td>
                    <td id="cpst-poc-vacante-8">$0</td>
                  </tr>
                  <tr class="nivel-7">
                    <td><span class="badge badge-primary">ü•à SEGUNDO PREMIO</span></td>
                    <td><strong>7 aciertos</strong></td>
                    <td id="cpst-poc-gan-7">0</td>
                    <td id="cpst-poc-premio-7">$0</td>
                    <td id="cpst-poc-total-7">$0</td>
                    <td>23.5%</td>
                    <td id="cpst-poc-vacante-7">$0</td>
                  </tr>
                  <tr class="nivel-6">
                    <td><span class="badge badge-secondary">ü•â TERCER PREMIO</span></td>
                    <td><strong>6 aciertos</strong></td>
                    <td id="cpst-poc-gan-6">0</td>
                    <td id="cpst-poc-premio-6">$0</td>
                    <td id="cpst-poc-total-6">$0</td>
                    <td>10%</td>
                    <td id="cpst-poc-vacante-6">$0</td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr style="background: var(--bg-card); font-weight: bold;">
                    <td colspan="2">TOTALES</td>
                    <td id="cpst-poc-gan-total">0</td>
                    <td>-</td>
                    <td id="cpst-poc-total-premios">$0</td>
                    <td>95.5%</td>
                    <td id="cpst-poc-vacante-total">$0</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- NUEVO: Desglose por Provincia (Poceada) -->
            <div style="margin-top: 1.5rem;">
              <h4 style="margin-bottom: 1rem;"><i class="fas fa-map-marked-alt"></i> Desglose por Provincia - Poceada
              </h4>
              <div class="table-container">
                <table class="table" id="cpst-tabla-poceada-provincias">
                  <thead>
                    <tr>
                      <th rowspan="2">Provincia</th>
                      <th rowspan="2">Total Pagado</th>
                      <th rowspan="2">Ganadores</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">8 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">7 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">6 Ac.</th>
                      <th colspan="2" class="text-center" style="border-bottom: 1px solid var(--border);">Letras</th>
                    </tr>
                    <tr>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                      <th>Gan</th>
                      <th>Prem.</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
            <small class="text-muted" style="display: none;">
              üí° El 4.5% restante es reserva. Si no hay ganadores, el pozo se acumula como arrastre para el pr√≥ximo
              sorteo.
            </small>
          </div>

          <!-- Desglose por tipo de apuesta m√∫ltiple -->
          <div style="margin-top: 1.5rem;">
            <h4 style="margin-bottom: 1rem;"><i class="fas fa-layer-group"></i> Desglose por Cantidad de N√∫meros
              Jugados</h4>
            <div class="table-container">
              <table class="table" id="cpst-tabla-poceada-multiples">
                <thead>
                  <tr>
                    <th>N√∫meros Jugados</th>
                    <th>Combinaciones</th>
                    <th>Registros</th>
                    <th>Gan. 8 Ac.</th>
                    <th>Gan. 7 Ac.</th>
                    <th>Gan. 6 Ac.</th>
                    <th>Total Premios</th>
                  </tr>
                </thead>
                <tbody id="cpst-tabla-poceada-multiples-body"></tbody>
              </table>
            </div>
          </div>

          <!-- Detalle Loto -->
          <div class="card hidden" id="cpst-detalle-loto">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3>Detalle por Modalidad - Loto</h3>
            </div>
            <div class="table-container">
              <table class="table" id="cpst-tabla-loto">
                <thead>
                  <tr>
                    <th>Modalidad</th>
                    <th>Nivel</th>
                    <th>Ganadores</th>
                    <th>Pozo XML</th>
                    <th>Premio Unitario</th>
                    <th>Total Premios</th>
                    <th>Pozo Vacante</th>
                  </tr>
                </thead>
                <tbody id="cpst-tabla-loto-body"></tbody>
              </table>
            </div>
          </div>

          <!-- Detalle Loto 5 -->
          <div class="card hidden" id="cpst-detalle-loto5">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3>Detalle de Premios - Loto 5</h3>
            </div>
            <div class="table-container">
              <table class="table" id="cpst-tabla-loto5">
                <thead>
                  <tr>
                    <th>Nivel</th>
                    <th>Ganadores</th>
                    <th>Pozo XML</th>
                    <th>Premio Unitario</th>
                    <th>Total Premios</th>
                    <th>Pozo Vacante</th>
                  </tr>
                </thead>
                <tbody id="cpst-tabla-loto5-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Ganadores Primer Premio (din√°mico para todos los juegos) -->
        <div id="cpst-ganadores-primer-premio" class="hidden"></div>

        <!-- Detalle por Tipo -->
        <div class="card">
          <div class="card-header">
            <h3>Premios por Tipo de Apuesta</h3>
          </div>
          <div id="cpst-detalle-tipos"></div>
        </div>

        <!-- Acciones -->
        <div class="card">
          <div class="form-actions" style="border: none; padding: 0; margin: 0;">
            <button class="btn btn-success" onclick="descargarExcel()">
              <i class="fas fa-file-excel"></i> Descargar Excel
            </button>
            <button class="btn btn-primary" onclick="generarPDFControlPosterior()">
              <i class="fas fa-file-pdf"></i> Generar Reporte PDF
            </button>
          </div>
        </div>
      </section>

      <!-- Actas -->
      <section id="view-actas" class="view hidden">
        <div class="page-header">
          <h1>Actas Notariales</h1>
          <p>Generaci√≥n de actas de sorteo</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Datos del Sorteo</h3>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="acta-juego">Juego</label>
              <select id="acta-juego" class="form-control">
                <option value="QUINIELA">Quiniela</option>
                <option value="POCEADA">Poceada</option>
              </select>
            </div>
            <div class="form-group">
              <label for="acta-modalidad">Modalidad</label>
              <select id="acta-modalidad" class="form-control">
                <option value="LA PREVIA">La Previa</option>
                <option value="LA PRIMERA">La Primera</option>
                <option value="MATUTINA">Matutina</option>
                <option value="VESPERTINA">Vespertina</option>
                <option value="NOCTURNA">Nocturna</option>
                <option value="MONTEVIDEO">Montevideo</option>
              </select>
            </div>
            <div class="form-group">
              <label for="acta-numero-sorteo">N¬∞ Sorteo</label>
              <input type="text" id="acta-numero-sorteo" class="form-control" placeholder="051676">
            </div>
            <div class="form-group">
              <label for="acta-fecha">Fecha</label>
              <input type="date" id="acta-fecha" class="form-control">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Personal del Sorteo</h3>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="acta-jefe">Jefe de Sorteo</label>
              <input type="text" id="acta-jefe" list="dl-jefes" class="form-control" placeholder="Seleccione...">
              <datalist id="dl-jefes">
                <option value="BRUNO LUCAS MATIAS">
                <option value="CAPRISTO FACUNDO JAVIER">
                <option value="BAISCH SANDRA MABEL">
                <option value="CASAMAYU DANIEL OMAR">
                <option value="CELIZ DIEGO MARIANO">
                <option value="CLAVIJO DANIELA JORGELINA">
                <option value="COLLOCA MANUEL JAVIER">
                <option value="CORDOBA LUCIANO MARTIN LUIS">
                <option value="CUCKOVICH ERNESTO">
                <option value="FRASCAROLI RODOLFO OSCAR">
                <option value="GONZALEZ MARIA CECILIA">
                <option value="GONZALEZ OMAR ALEJANDRO">
                <option value="GONZALO MASSA">
                <option value="LEVANTINI HERNAN ALEJANDRO">
                <option value="MALLET SERGIO RICARDO">
                <option value="MARTUCCI SEBASTIAN ARIEL">
                <option value="NOVOA MARCELO ESTEBAN">
                <option value="SANTOIANNI ALFREDO">
                <option value="SUAREZ RODRIGO JOEL">
              </datalist>
            </div>
            <div class="form-group">
              <label for="acta-estado-civil">Estado Civil</label>
              <select id="acta-estado-civil" class="form-control">
                <option value="CASADO">Casado</option>
                <option value="SOLTERO">Soltero</option>
                <option value="VIUDO">Viudo</option>
                <option value="DIVORCIADO">Divorciado</option>
              </select>
            </div>
            <div class="form-group">
              <label for="acta-escribano">Escribano</label>
              <input type="text" id="acta-escribano" list="dl-escribanos" class="form-control"
                placeholder="Seleccione...">
              <datalist id="dl-escribanos">
                <option value="MITJANS FERNANDO">
                <option value="AGUILAR FLORENCIA">
                <option value="DAMS DOLORES">
                <option value="ALLENDE CARLOS">
                <option value="KORNIUSZA CECILIA CELESTE">
                <option value="MAIDANA FERNANDO">
                <option value="TABORDA NADIA">
                <option value="REYES MARCELA">
                <option value="SCHLENEW ELENA">
                <option value="SOARES ALFREDO">
                <option value="VAZQUEZ LUCIA">
                <option value="GILDA SALTARELLI">
                <option value="BUEZAS MARIA EUGENIA">
              </datalist>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="acta-operador-sorteo">Operador de Sorteo</label>
              <input type="text" id="acta-operador-sorteo" list="dl-jefes" class="form-control"
                placeholder="Seleccione...">
            </div>
            <div class="form-group">
              <label for="acta-operador-tecnica">Operador √Årea T√©cnica</label>
              <input type="text" id="acta-operador-tecnica" list="dl-jefes" class="form-control"
                placeholder="Seleccione...">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Tipo de Acta</h3>
          </div>

          <div class="radio-group" style="display: flex; gap: 2rem; margin-bottom: 1rem;">
            <label class="radio-label">
              <input type="radio" name="tipo-acta" value="RNG" checked> Acta con RNG
            </label>
            <label class="radio-label">
              <input type="radio" name="tipo-acta" value="BOLILLEROS"> Acta Bolilleros Manuales
            </label>
            <label class="radio-label">
              <input type="radio" name="tipo-acta" value="SUSTITUTO"> Acta Sustituto
            </label>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="acta-hora-inicio">Hora de Inicio</label>
              <input type="time" id="acta-hora-inicio" class="form-control">
            </div>
            <div class="form-group">
              <label for="acta-hora-programada">Hora Programada</label>
              <input type="time" id="acta-hora-programada" class="form-control">
            </div>
            <div class="form-group">
              <label for="acta-numero-rng">N√∫mero RNG</label>
              <input type="text" id="acta-numero-rng" class="form-control" placeholder="123456">
            </div>
            <div class="form-group">
              <label for="acta-ultimo-rng">√öltimo N¬∞ RNG</label>
              <input type="text" id="acta-ultimo-rng" class="form-control" placeholder="123455">
            </div>
          </div>

          <div class="form-row" id="acta-sustituto-row" style="display: none;">
            <div class="form-group">
              <label for="acta-sorteo-sustituto">N¬∞ Sorteo Sustituto</label>
              <input type="text" id="acta-sorteo-sustituto" class="form-control" placeholder="051675">
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Jurisdicciones y Observaciones</h3>
          </div>

          <div class="form-group">
            <label>Jurisdicciones con Apuestas</label>
            <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.5rem;">
              <label><input type="checkbox" id="jur-caba" checked> Ciudad Aut√≥noma</label>
              <label><input type="checkbox" id="jur-bsas" checked> Buenos Aires</label>
              <label><input type="checkbox" id="jur-cordoba" checked> C√≥rdoba</label>
              <label><input type="checkbox" id="jur-santafe" checked> Santa Fe</label>
              <label><input type="checkbox" id="jur-montevideo"> Montevideo</label>
              <label><input type="checkbox" id="jur-mendoza" checked> Mendoza</label>
              <label><input type="checkbox" id="jur-entrerios" checked> Entre R√≠os</label>
            </div>
          </div>

          <div class="form-group">
            <label for="acta-observaciones">Observaciones</label>
            <textarea id="acta-observaciones" class="form-control" rows="3"
              placeholder="Observaciones adicionales..."></textarea>
          </div>
        </div>

        <div class="card">
          <div class="form-actions" style="border: none; padding: 0; margin: 0;">
            <button class="btn btn-secondary" onclick="limpiarActa()">
              <i class="fas fa-trash"></i> Limpiar
            </button>
            <button class="btn btn-primary" onclick="generarActaNotarial()">
              <i class="fas fa-file-pdf"></i> Generar Acta PDF
            </button>
          </div>
        </div>
      </section>

      <!-- Programaci√≥n de Sorteos -->
      <section id="view-programacion" class="view hidden">
        <div class="page-header">
          <div>
            <h1><i class="fas fa-calendar-alt"></i> Programaci√≥n de Sorteos</h1>
            <p>Cargar y gestionar la programaci√≥n mensual de sorteos</p>
          </div>
        </div>

        <!-- Cargar Excel -->
        <div class="card">
          <h3><i class="fas fa-file-excel"></i> Cargar Programaci√≥n desde Excel</h3>
          <div class="form-row">
            <div class="form-group" style="flex: 2;">
              <label>Archivo Excel (.xlsx) - <span style="color: var(--primary-color);">Detecci√≥n autom√°tica del
                  juego</span></label>
              <input type="file" id="programacion-archivo" class="form-control" accept=".xlsx,.xls">
            </div>
            <div class="form-group" style="flex: 0;">
              <label>&nbsp;</label>
              <button class="btn btn-primary" onclick="cargarProgramacionExcelGenerico()">
                <i class="fas fa-magic"></i> Cargar Autom√°tico
              </button>
            </div>
            <div class="form-group" style="flex: 0;">
              <label>&nbsp;</label>
              <button class="btn btn-danger" onclick="borrarProgramacion()"
                title="Borrar toda la programaci√≥n antes de cargar">
                <i class="fas fa-trash"></i> Borrar Todo
              </button>
            </div>
          </div>
          <div class="alert alert-info" style="margin-top: 0.5rem;">
            <i class="fas fa-info-circle"></i> <strong>Detecci√≥n autom√°tica:</strong>
            El sistema detecta el tipo de juego desde la columna "Juego" del Excel.
            Soporta: <span class="badge badge-primary">Quiniela</span>
            <span class="badge badge-success">Quini 6</span>
            <span class="badge badge-warning">Brinco</span>
            <span class="badge badge-info">Loto 5 Plus</span>
            <span class="badge badge-purple">Loto Plus</span>
            <span class="badge badge-danger">Poceada</span>
            <span class="badge badge-dark">Tombolina</span>
          </div>
          <div id="programacion-upload-result" class="alert hidden"></div>
        </div>


        <!-- Filtros y Listado -->
        <div class="card">
          <h3><i class="fas fa-list"></i> Programaci√≥n Cargada</h3>
          <div class="form-row">
            <div class="form-group">
              <label>Juego</label>
              <select id="programacion-filtro-juego" class="form-control">
                <option value="" selected>Todos los juegos</option>
                <option value="Quiniela">Quiniela</option>
                <option value="Quini 6">Quini 6</option>
                <option value="Brinco">Brinco</option>
                <option value="Loto 5 Plus">Loto 5 Plus</option>
                <option value="Loto Plus Tradicional">Loto Plus Tradicional</option>
                <option value="Quiniela Poceada">Quiniela Poceada</option>
                <option value="Tombolina">Tombolina</option>
              </select>
            </div>
            <div class="form-group">
              <label>Mes</label>
              <input type="month" id="programacion-filtro-mes" class="form-control">
            </div>
            <div class="form-group">
              <label>Modalidad</label>
              <select id="programacion-filtro-modalidad" class="form-control">
                <option value="" selected>Todas</option>
                <option value="R">La Previa</option>
                <option value="P">Primera</option>
                <option value="M">Matutina</option>
                <option value="V">Vespertina</option>
                <option value="N">Nocturna</option>
              </select>
            </div>
            <div class="form-group">
              <label>&nbsp;</label>
              <button class="btn btn-secondary" onclick="buscarProgramacion()">
                <i class="fas fa-search"></i> Buscar
              </button>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table" id="table-programacion">
              <thead>
                <tr>
                  <th>Sorteo</th>
                  <th>Juego</th>
                  <th>Fecha</th>
                  <th>Hora</th>
                  <th>Modalidad</th>
                  <th>CABA</th>
                  <th>BS.AS</th>
                  <th>CBA</th>
                  <th>STA.FE</th>
                  <th>URU</th>
                  <th>MZA</th>
                  <th>E.RS</th>
                </tr>
              </thead>

              <tbody></tbody>
            </table>
          </div>
          <div id="programacion-paginacion" class="pagination"></div>
        </div>

        <!-- Historial de Cargas -->
        <div class="card">
          <h3><i class="fas fa-history"></i> Historial de Cargas</h3>
          <table class="table" id="table-programacion-cargas">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Juego</th>
                <th>Mes</th>
                <th>Archivo</th>
                <th>Registros</th>
                <th>Actualizados</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Reportes -->
      <section id="view-reportes" class="view hidden">
        <div class="page-header">
          <h1>Reportes e Historial</h1>
          <p>An√°lisis de recaudaci√≥n, premios y consulta de datos procesados</p>
        </div>

        <!-- Tabs de Reportes -->
        <div class="tabs-container mb-4">
          <button class="tab-btn active" data-reportes-tab="dashboard">
            <i class="fas fa-chart-bar"></i> Dashboard
          </button>
          <button class="tab-btn" data-reportes-tab="control-previo">
            <i class="fas fa-file-import"></i> Control Previo
          </button>
          <button class="tab-btn" data-reportes-tab="escrutinios">
            <i class="fas fa-trophy"></i> Escrutinios
          </button>
        </div>

        <!-- ========== TAB: DASHBOARD ========== -->
        <div id="reportes-tab-dashboard" class="reportes-tab-content">
          <!-- Filtros del Dashboard -->
          <div class="card mb-4">
            <div class="card-header">
              <h3><i class="fas fa-filter"></i> Filtros</h3>
            </div>
            <div class="card-body">
              <!-- Selector de Juegos -->
              <div class="game-selector mb-3">
                <label class="form-label fw-bold">Seleccionar Juegos:</label>
                <div class="game-checkboxes" style="display: flex; flex-wrap: wrap; gap: 1rem;">
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-todos" onchange="toggleDashboardGame('todos')" checked>
                    <span class="checkmark game-todos">üìä TODOS</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-quiniela" onchange="toggleDashboardGame('quiniela')">
                    <span class="checkmark game-quiniela">üé∞ QUINIELA</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-poceada" onchange="toggleDashboardGame('poceada')">
                    <span class="checkmark game-poceada">üéØ POCEADA</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-tombolina" onchange="toggleDashboardGame('tombolina')">
                    <span class="checkmark game-tombolina">üé± TOMBOLINA</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-quini6" onchange="toggleDashboardGame('quini6')">
                    <span class="checkmark game-quini6">‚ú® QUINI 6</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-brinco" onchange="toggleDashboardGame('brinco')">
                    <span class="checkmark game-brinco">üíé BRINCO</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-loto" onchange="toggleDashboardGame('loto')">
                    <span class="checkmark game-loto">üèÜ LOTO</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-loto5" onchange="toggleDashboardGame('loto5')">
                    <span class="checkmark game-loto5">üñêÔ∏è LOTO 5</span>
                  </label>
                  <label class="game-checkbox">
                    <input type="checkbox" id="dash-game-hipicas" onchange="toggleDashboardGame('hipicas')">
                    <span class="checkmark game-hipicas">üê¥ HIPICAS</span>
                  </label>
                </div>
              </div>

              <!-- Filtros -->
              <div class="row g-2 align-items-end">
                <div class="col-lg-2 col-md-3">
                  <label class="form-label">Fecha Desde</label>
                  <input type="date" class="form-control form-control-sm" id="dash-fecha-desde">
                </div>
                <div class="col-lg-2 col-md-3">
                  <label class="form-label">Fecha Hasta</label>
                  <input type="date" class="form-control form-control-sm" id="dash-fecha-hasta">
                </div>
                <div class="col-lg-1 col-md-2">
                  <label class="form-label">Sorteo Desde</label>
                  <input type="number" class="form-control form-control-sm" id="dash-sorteo-desde" placeholder="51900">
                </div>
                <div class="col-lg-1 col-md-2">
                  <label class="form-label">Sorteo Hasta</label>
                  <input type="number" class="form-control form-control-sm" id="dash-sorteo-hasta" placeholder="52000">
                </div>
                <div class="col-lg-2 col-md-3">
                  <label class="form-label">Agencia</label>
                  <select class="form-control form-control-sm" id="dash-agencia">
                    <option value="">Todas las agencias</option>
                  </select>
                </div>
                <div class="col-lg-2 col-md-3">
                  <label class="form-label">Vista</label>
                  <select class="form-control form-control-sm" id="dash-tipo-consulta">
                    <option value="agencias">üìã Agencias c/Premio</option>
                    <option value="agencias_venta">üí∞ Agencias c/Venta</option>
                    <option value="agrupado_agencia">üè¢ Totalizado por Agencia</option>
                    <option value="detallado">üìä Detallado por Sorteo</option>
                    <option value="comparativo">‚öñÔ∏è Comparativo por Juego</option>
                  </select>
                </div>
                <div class="col-lg-2 col-md-3">
                  <div class="d-flex gap-2">
                    <button class="btn btn-primary btn-sm flex-grow-1" onclick="buscarDashboard()">
                      <i class="fas fa-search"></i> Buscar
                    </button>
                    <button class="btn btn-secondary btn-sm" onclick="limpiarFiltrosDashboard()"
                      title="Limpiar filtros">
                      <i class="fas fa-eraser"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Estad√≠sticas -->
          <div class="stats-grid mb-4" id="dash-stats-grid">
            <div class="stat-card recaudacion">
              <div class="stat-value dash-stat-responsive" id="dash-stat-recaudacion">$0</div>
              <div class="stat-label">Recaudaci\u00f3n Total</div>
            </div>
            <div class="stat-card premios">
              <div class="stat-value dash-stat-responsive" id="dash-stat-premios">$0</div>
              <div class="stat-label">Premios Pagados</div>
            </div>
            <div class="stat-card apuestas">
              <div class="stat-value dash-stat-responsive" id="dash-stat-apuestas">0</div>
              <div class="stat-label">Total Apuestas</div>
            </div>
            <div class="stat-card tickets">
              <div class="stat-value dash-stat-responsive" id="dash-stat-tickets">0</div>
              <div class="stat-label">Total Tickets</div>
            </div>
            <div class="stat-card sorteos">
              <div class="stat-value" id="dash-stat-sorteos">0</div>
              <div class="stat-label">Sorteos</div>
            </div>
            <div class="stat-card provincias">
              <div class="stat-value" id="dash-stat-provincias">0</div>
              <div class="stat-label">Provincias c/Apuestas</div>
            </div>
            <div class="stat-card agencias">
              <div class="stat-value" id="dash-stat-agencias">0</div>
              <div class="stat-label">Agencias c/Premios</div>
            </div>
            <div class="stat-card agencias-venta">
              <div class="stat-value" id="dash-stat-agencias-venta">0</div>
              <div class="stat-label">Agencias c/Venta</div>
            </div>
          </div>

          <!-- Resultados Dashboard -->
          <div class="card">
            <div class="card-header dash-results-header">
              <div class="d-flex justify-content-between align-items-center">
                <h3><i class="fas fa-table"></i> Resultados <span id="dash-results-count"
                    class="badge bg-secondary ms-2">0</span></h3>
                <div class="d-flex gap-2">
                  <span id="dash-game-indicator" class="badge bg-info">Todos los juegos</span>
                  <button class="btn btn-sm btn-success" onclick="exportarDashboardCSV()">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                  </button>
                </div>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                <table class="table table-hover mb-0" id="table-dashboard">
                  <thead id="table-dashboard-header"></thead>
                  <tbody id="table-dashboard-body"></tbody>
                </table>
              </div>
              <div id="dash-no-data" class="text-center text-muted py-5 hidden">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>No hay datos para mostrar. Aplique filtros y presione Buscar.</p>
              </div>
              <div id="dash-loading" class="text-center py-5 hidden">
                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                <p>Cargando datos...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== TAB: CONTROL PREVIO ========== -->
        <div id="reportes-tab-control-previo" class="reportes-tab-content hidden">
          <!-- Filtros Control Previo -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-md-3">
                  <label class="form-label">Fecha Desde</label>
                  <input type="date" class="form-control" id="cp-fecha-desde">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Fecha Hasta</label>
                  <input type="date" class="form-control" id="cp-fecha-hasta">
                </div>
                <div class="col-md-2">
                  <label class="form-label">Juego</label>
                  <select class="form-control" id="cp-juego">
                    <option value="">Todos</option>
                    <option value="quiniela">Quiniela</option>
                    <option value="poceada">Poceada</option>
                    <option value="tombolina">Tombolina</option>
                    <option value="loto">Loto</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <button class="btn btn-primary w-100" onclick="buscarControlPrevio()">
                    <i class="fas fa-search"></i> Buscar
                  </button>
                </div>
                <div class="col-md-2">
                  <button class="btn btn-success w-100" onclick="exportarControlPrevioCSV()">
                    <i class="fas fa-download"></i> Exportar
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Tabla Control Previo -->
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-file-import"></i> Historial de Control Previo</h3>
            </div>
            <div class="card-body p-0">
              <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                <table class="table table-hover mb-0" id="table-historial-cp">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Sorteo</th>
                      <th>Modalidad</th>
                      <th>Juego</th>
                      <th>Registros</th>
                      <th>Apuestas</th>
                      <th>Anulados</th>
                      <th>Recaudaci√≥n</th>
                      <th>Usuario</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <div id="historial-cp-empty" class="text-center text-muted py-4 hidden">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>No hay registros para mostrar</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ========== TAB: ESCRUTINIOS ========== -->
        <div id="reportes-tab-escrutinios" class="reportes-tab-content hidden">
          <!-- Filtros Escrutinios -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row g-3 align-items-end">
                <div class="col-md-3">
                  <label class="form-label">Fecha Desde</label>
                  <input type="date" class="form-control" id="esc-fecha-desde">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Fecha Hasta</label>
                  <input type="date" class="form-control" id="esc-fecha-hasta">
                </div>
                <div class="col-md-2">
                  <label class="form-label">Juego</label>
                  <select class="form-control" id="esc-juego">
                    <option value="">Todos</option>
                    <option value="quiniela">Quiniela</option>
                    <option value="poceada">Poceada</option>
                    <option value="tombolina">Tombolina</option>
                    <option value="loto">Loto</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <button class="btn btn-primary w-100" onclick="buscarEscrutinios()">
                    <i class="fas fa-search"></i> Buscar
                  </button>
                </div>
                <div class="col-md-2">
                  <button class="btn btn-success w-100" onclick="exportarEscrutiniosCSV()">
                    <i class="fas fa-download"></i> Exportar
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Tabla Escrutinios -->
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-trophy"></i> Historial de Escrutinios</h3>
            </div>
            <div class="card-body p-0">
              <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                <table class="table table-hover mb-0" id="table-historial-escrutinio">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Sorteo</th>
                      <th>Modalidad</th>
                      <th>Juego</th>
                      <th>Total Ganadores</th>
                      <th>Total Premios</th>
                      <th>Usuario</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <div id="historial-escrutinio-empty" class="text-center text-muted py-4 hidden">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>No hay escrutinios para mostrar</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Detalle -->
        <div id="modal-dash-detalle" class="modal-overlay hidden">
          <div class="modal-container modal-lg">
            <div class="modal-header">
              <h2 id="modal-dash-titulo">Detalle</h2>
              <button class="modal-close" onclick="cerrarModalDashDetalle()">&times;</button>
            </div>
            <div class="modal-body" id="modal-dash-contenido">
              <!-- Contenido din√°mico -->
            </div>
          </div>
        </div>
      </section>

      <!-- Usuarios -->
      <section id="view-usuarios" class="view hidden">
        <div class="page-header">
          <div>
            <h1>Usuarios</h1>
            <p>Gesti√≥n de usuarios del sistema</p>
          </div>
          <button class="btn btn-primary" onclick="mostrarModalUsuario()">
            <i class="fas fa-plus"></i> Nuevo Usuario
          </button>
        </div>

        <div class="card">
          <table class="table" id="table-usuarios">
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Nombre</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>√öltimo Login</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- Auditor√≠a -->
      <section id="view-auditoria" class="view hidden">
        <div class="page-header">
          <h1>Auditor√≠a</h1>
          <p>Historial de acciones del sistema</p>
        </div>
        <div class="card">
          <p class="text-muted">M√≥dulo de auditor√≠a - En desarrollo</p>
        </div>
      </section>

      <!-- Juegos Offline -->
      <section id="view-juegos-offline" class="view hidden">
        <div class="page-header">
          <h1><i class="fas fa-horse-head"></i> Juegos Offline</h1>
          <p>Procesamiento de facturaci√≥n: Hipicas, Telekino y Money Las Vegas</p>
        </div>

        <!-- Selecci√≥n de Juego -->
        <div class="card" style="border-left: 4px solid var(--warning);">
          <div class="card-header">
            <h3><i class="fas fa-dice"></i> Seleccionar Juego</h3>
          </div>
          <div class="card-body">
            <div class="form-row" style="display: flex; flex-wrap: wrap; gap: 1rem;">
              <div class="form-group" style="flex: 1; min-width: 180px;">
                <label class="radio-card" onclick="seleccionarJuegoOffline('hipicas')" style="cursor:pointer; padding: 1rem; border: 2px solid var(--warning); border-radius: 8px; display: block; text-align: center;">
                  <input type="radio" name="juego-offline" value="hipicas" checked style="display:none;">
                  <div>
                    <div style="font-size: 2rem;">&#x1F40E;</div>
                    <strong>Hipicas</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.8rem;">Palermo, La Plata, San Isidro</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 1; min-width: 180px;">
                <label class="radio-card" style="cursor:not-allowed; padding: 1rem; border: 2px solid var(--border-color); border-radius: 8px; display: block; text-align: center; opacity: 0.5;">
                  <input type="radio" name="juego-offline" value="telekino" disabled style="display:none;">
                  <div>
                    <div style="font-size: 2rem;">&#x1F3B0;</div>
                    <strong>Telekino</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.8rem;">Proximamente</p>
                  </div>
                </label>
              </div>
              <div class="form-group" style="flex: 1; min-width: 180px;">
                <label class="radio-card" style="cursor:not-allowed; padding: 1rem; border: 2px solid var(--border-color); border-radius: 8px; display: block; text-align: center; opacity: 0.5;">
                  <input type="radio" name="juego-offline" value="money" disabled style="display:none;">
                  <div>
                    <div style="font-size: 2rem;">&#x1F4B0;</div>
                    <strong>Money Las Vegas</strong>
                    <p class="text-muted" style="margin: 0; font-size: 0.8rem;">Proximamente</p>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Secci√≥n Hipicas -->
        <div id="seccion-hipicas">
          <!-- Cargar Archivo TXT -->
          <div class="card">
            <div class="card-header">
              <h3><i class="fas fa-file-upload"></i> 1. Cargar Archivo TXT</h3>
            </div>
            <div class="card-body">
              <div class="upload-area" id="hipicas-upload-area" style="padding: 2rem; text-align: center;">
                <i class="fas fa-file-alt" style="font-size: 3rem; color: var(--warning); margin-bottom: 1rem;"></i>
                <h4>Arrastre el archivo TXT aqui o haga clic para seleccionar</h4>
                <p class="text-muted">Archivo de facturaci√≥n Hipicas (.txt) - El sistema detecta el hipodromo automaticamente</p>
                <button class="btn btn-warning" style="margin-top: 1rem;" onclick="document.getElementById('hipicas-archivo-input').click()">
                  <i class="fas fa-folder-open"></i> Seleccionar Archivo
                </button>
                <input type="file" id="hipicas-archivo-input" accept=".txt" hidden>
              </div>

              <!-- Info del archivo cargado -->
              <div id="hipicas-archivo-info" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-input); border-radius: 8px;">
                <div style="display: flex; gap: 2rem; flex-wrap: wrap; align-items: center;">
                  <span><i class="fas fa-file"></i> <strong id="hipicas-nombre-archivo">-</strong></span>
                  <span><i class="fas fa-database"></i> <strong id="hipicas-lineas-info">-</strong></span>
                </div>
              </div>
            </div>
          </div>

          <!-- Resultados -->
          <div class="card" id="hipicas-resultados-card" style="display: none;">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3><i class="fas fa-chart-bar"></i> 2. Resultados del Procesamiento</h3>
            </div>
            <div class="card-body">
              <!-- Resumen -->
              <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                <div class="stat-card">
                  <div class="stat-icon" style="background: var(--warning); color: #000;"><i class="fas fa-building"></i></div>
                  <div class="stat-value" id="hipicas-total-agencias">0</div>
                  <div class="stat-label">Total Agencias</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon blue"><i class="fas fa-dollar-sign"></i></div>
                  <div class="stat-value" id="hipicas-recaudacion-total">$0</div>
                  <div class="stat-label">Recaudacion Total</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon" style="background: var(--success); color: #fff;"><i class="fas fa-trophy"></i></div>
                  <div class="stat-value" id="hipicas-total-premios">$0</div>
                  <div class="stat-label">Total Premios</div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon" style="background: var(--info); color: #fff;"><i class="fas fa-horse-head"></i></div>
                  <div class="stat-value" id="hipicas-total-sorteos">0</div>
                  <div class="stat-label">Sorteos Procesados</div>
                </div>
              </div>

              <!-- Tabla de Datos -->
              <div class="table-responsive" style="margin-top: 2rem; max-height: 500px; overflow-y: auto;">
                <table class="table" id="hipicas-tabla-resultados">
                  <thead>
                    <tr>
                      <th>Sorteo</th>
                      <th>Hipodromo</th>
                      <th>Reunion</th>
                      <th>Agencia</th>
                      <th>Recaudacion</th>
                      <th>Cancelaciones</th>
                      <th>Devoluciones</th>
                      <th>Premios</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                  <tfoot>
                    <tr style="font-weight: bold; background: var(--bg-input);">
                      <td colspan="4">TOTALES</td>
                      <td id="hipicas-foot-recaudacion">$0</td>
                      <td id="hipicas-foot-cancelaciones">$0</td>
                      <td id="hipicas-foot-devoluciones">$0</td>
                      <td id="hipicas-foot-premios">$0</td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>

          <!-- Historial -->
          <div class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
              <h3><i class="fas fa-history"></i> Historial de Cargas</h3>
              <button class="btn btn-sm btn-secondary" onclick="cargarHistorialHipicas()">
                <i class="fas fa-sync"></i> Actualizar
              </button>
            </div>
            <div class="card-body">
              <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                <div class="form-group" style="flex: 1;">
                  <label>Filtrar por fecha</label>
                  <input type="date" id="hipicas-filtro-fecha" class="form-control" onchange="cargarHistorialHipicas()">
                </div>
                <div class="form-group" style="flex: 1;">
                  <label>Filtrar por hipodromo</label>
                  <select id="hipicas-filtro-hipodromo" class="form-control" onchange="cargarHistorialHipicas()">
                    <option value="">Todos</option>
                    <option value="0099">Palermo (HP)</option>
                    <option value="0021">La Plata (LP)</option>
                    <option value="0020">San Isidro (SI)</option>
                  </select>
                </div>
              </div>
              <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
                <table class="table" id="hipicas-tabla-historial">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Sorteo</th>
                      <th>Hipodromo</th>
                      <th>Agencia</th>
                      <th>Recaudacion</th>
                      <th>Cancelaciones</th>
                      <th>Devoluciones</th>
                      <th>Premios</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="7" class="text-center text-muted">Use los filtros para buscar registros</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Reporte de Ventas Turfito -->
          <div class="card" id="hipicas-ventas-card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%);">
              <h3 style="color: white;"><i class="fas fa-chart-bar"></i> Reporte de Ventas Turfito</h3>
              <button class="btn btn-sm" style="background: white; color: #ff5722;" onclick="exportarVentasTurfitoExcel()">
                <i class="fas fa-file-excel"></i> Exportar Excel
              </button>
            </div>
            <div class="card-body">
              <div class="form-row" style="gap: 1rem; margin-bottom: 1rem; align-items: flex-end;">
                <div class="form-group" style="flex: 1;">
                  <label>Fecha Desde</label>
                  <input type="date" id="hipicas-ventas-desde" class="form-control">
                </div>
                <div class="form-group" style="flex: 1;">
                  <label>Fecha Hasta</label>
                  <input type="date" id="hipicas-ventas-hasta" class="form-control">
                </div>
                <div class="form-group">
                  <button class="btn btn-primary" onclick="buscarVentasTurfito()">
                    <i class="fas fa-search"></i> Buscar
                  </button>
                </div>
              </div>
              
              <!-- Totales -->
              <div id="hipicas-ventas-totales" style="display: none; margin-bottom: 1rem;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem;">
                  <div class="stat-card" style="background: rgba(255, 152, 0, 0.1); border-left: 3px solid #ff9800; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Recaudaci√≥n Bruta</div>
                    <div id="hipicas-ventas-total-bruta" style="font-size: 1.1rem; font-weight: 600; color: #ff9800;">$0</div>
                  </div>
                  <div class="stat-card" style="background: rgba(244, 67, 54, 0.1); border-left: 3px solid #f44336; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Cancelaciones</div>
                    <div id="hipicas-ventas-total-cancel" style="font-size: 1.1rem; font-weight: 600; color: #f44336;">$0</div>
                  </div>
                  <div class="stat-card" style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9c27b0; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Devoluciones</div>
                    <div id="hipicas-ventas-total-devol" style="font-size: 1.1rem; font-weight: 600; color: #9c27b0;">$0</div>
                  </div>
                  <div class="stat-card" style="background: rgba(76, 175, 80, 0.1); border-left: 3px solid #4caf50; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Total Neto</div>
                    <div id="hipicas-ventas-total-neto" style="font-size: 1.1rem; font-weight: 600; color: #4caf50;">$0</div>
                  </div>
                </div>
              </div>

              <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
                <table class="table" id="hipicas-tabla-ventas">
                  <thead style="position: sticky; top: 0; background: var(--bg-card);">
                    <tr>
                      <th>Fecha</th>
                      <th>Hip√≥dromo</th>
                      <th>Reuni√≥n</th>
                      <th style="text-align: right;">Recaudaci√≥n Bruta</th>
                      <th style="text-align: right;">Cancelaciones</th>
                      <th style="text-align: right;">Devoluciones</th>
                      <th style="text-align: right;">Total Neto</th>
                      <th style="text-align: center;">Agencias</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td colspan="8" class="text-center text-muted" style="padding: 2rem;">Seleccione un rango de fechas y haga click en Buscar</td></tr>
                  </tbody>
                </table>
              </div>

              <!-- Facturaci√≥n UTE -->
              <div id="hipicas-facturacion-ute" style="display: none; margin-top: 2rem; border-top: 2px solid var(--border-color); padding-top: 1.5rem;">
                <h4 style="margin-bottom: 1rem; color: #2196f3;">
                  <i class="fas fa-file-invoice-dollar"></i> Facturaci√≥n UTE - Capital Federal
                </h4>
                
                <!-- Constantes y Totales -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem;">
                  <div class="stat-card" style="background: rgba(33, 150, 243, 0.1); border-left: 3px solid #2196f3; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Recaudaci√≥n Total</div>
                    <div id="ute-recaudacion-total" style="font-size: 1.1rem; font-weight: 600; color: #2196f3;">$0</div>
                  </div>
                  <div class="stat-card" style="background: rgba(156, 39, 176, 0.1); border-left: 3px solid #9c27b0; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Tope Estipulado</div>
                    <div id="ute-tope" style="font-size: 1.1rem; font-weight: 600; color: #9c27b0;">$75.000.000</div>
                  </div>
                  <div class="stat-card" style="background: rgba(255, 152, 0, 0.1); border-left: 3px solid #ff9800; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Excedente (25%)</div>
                    <div id="ute-excedente" style="font-size: 1.1rem; font-weight: 600; color: #ff9800;">$0</div>
                  </div>
                  <div class="stat-card" style="background: rgba(76, 175, 80, 0.1); border-left: 3px solid #4caf50; padding: 0.75rem;">
                    <div style="font-size: 0.75rem; color: var(--text-muted);">Total a Facturar</div>
                    <div id="ute-total-facturar" style="font-size: 1.1rem; font-weight: 600; color: #4caf50;">$0</div>
                  </div>
                </div>

                <!-- Tabla Facturaci√≥n por Hip√≥dromo -->
                <div class="table-responsive">
                  <table class="table" id="hipicas-tabla-ute">
                    <thead>
                      <tr style="background: rgba(33, 150, 243, 0.1);">
                        <th>Hip√≥dromo</th>
                        <th style="text-align: right;">Recaudaci√≥n</th>
                        <th style="text-align: center;">Particip. %</th>
                        <th style="text-align: right;">Dentro Tope</th>
                        <th style="text-align: right;">Sobre Tope</th>
                        <th style="text-align: right;">Monto Facturar</th>
                        <th style="text-align: right;">Descuento 20.2%</th>
                        <th style="text-align: right;">IVA 21%</th>
                        <th style="text-align: right; color: #4caf50; font-weight: bold;">TOTAL</th>
                      </tr>
                    </thead>
                    <tbody id="ute-tabla-body">
                    </tbody>
                    <tfoot id="ute-tabla-footer" style="font-weight: bold; background: rgba(33, 150, 243, 0.15);">
                    </tfoot>
                  </table>
                </div>
                <!-- Contenedor para l√≠neas SAP -->
                <div id="ute-lineas-sap-container"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Secci√≥n Telekino (futuro) -->
        <div id="seccion-telekino" style="display: none;">
          <div class="card">
            <div class="card-body text-center" style="padding: 3rem;">
              <i class="fas fa-tools" style="font-size: 3rem; color: var(--text-muted);"></i>
              <h3 class="text-muted" style="margin-top: 1rem;">Telekino - Proximamente</h3>
              <p class="text-muted">Este modulo esta en desarrollo</p>
            </div>
          </div>
        </div>

        <!-- Secci√≥n Money Las Vegas (futuro) -->
        <div id="seccion-money" style="display: none;">
          <div class="card">
            <div class="card-body text-center" style="padding: 3rem;">
              <i class="fas fa-tools" style="font-size: 3rem; color: var(--text-muted);"></i>
              <h3 class="text-muted" style="margin-top: 1rem;">Money Las Vegas - Proximamente</h3>
              <p class="text-muted">Este modulo esta en desarrollo</p>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Modal Pozos de Arrastre (Poceada) -->
  <div id="modal-pozos-arrastre" class="modal-overlay hidden">
    <div class="modal-content" style="max-width: 550px;">
      <div class="modal-header">
        <h3><i class="fas fa-piggy-bank"></i> Pozos de Arrastre</h3>
        <button class="btn-close" onclick="cerrarModalPozosArrastre()">&times;</button>
      </div>
      <div class="modal-body">
        <div
          style="background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; padding: 0.8rem 1rem; margin-bottom: 1.2rem;">
          <small><i class="fas fa-info-circle text-warning"></i> No se encontraron datos de arrastre del sorteo anterior
            en la base de datos. Ingrese los montos manualmente para calcular correctamente la distribuci√≥n de
            premios.</small>
        </div>
        <div id="pozos-arrastre-sorteo-info"
          style="margin-bottom: 1rem; font-weight: 600; color: var(--text-secondary);"></div>
        <div style="display: grid; gap: 1rem;">
          <div>
            <label style="display: block; margin-bottom: 0.3rem; font-weight: 600; color: var(--accent-color);">
              <i class="fas fa-medal" style="color: gold;"></i> 1er Premio (8 aciertos) - Arrastre
            </label>
            <div style="position: relative;">
              <span
                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-weight: bold; color: var(--text-secondary);">$</span>
              <input type="text" id="pozo-arrastre-1er" class="form-control" placeholder="0"
                style="padding-left: 25px; font-size: 1.1rem;">
            </div>
          </div>
          <div>
            <label style="display: block; margin-bottom: 0.3rem; font-weight: 600; color: var(--text-secondary);">
              <i class="fas fa-medal" style="color: silver;"></i> 2do Premio (7 aciertos) - Arrastre
            </label>
            <div style="position: relative;">
              <span
                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-weight: bold; color: var(--text-secondary);">$</span>
              <input type="text" id="pozo-arrastre-2do" class="form-control" placeholder="0"
                style="padding-left: 25px; font-size: 1.1rem;">
            </div>
          </div>
          <div>
            <label style="display: block; margin-bottom: 0.3rem; font-weight: 600; color: var(--text-secondary);">
              <i class="fas fa-medal" style="color: #cd7f32;"></i> 3er Premio (6 aciertos) - Arrastre
            </label>
            <div style="position: relative;">
              <span
                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-weight: bold; color: var(--text-secondary);">$</span>
              <input type="text" id="pozo-arrastre-3er" class="form-control" placeholder="0"
                style="padding-left: 25px; font-size: 1.1rem;">
            </div>
          </div>
          <div>
            <label style="display: block; margin-bottom: 0.3rem; font-weight: 600; color: var(--text-secondary);">
              <i class="fas fa-user-tie" style="color: var(--info-color);"></i> Premio Agenciero - Arrastre
            </label>
            <div style="position: relative;">
              <span
                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-weight: bold; color: var(--text-secondary);">$</span>
              <input type="text" id="pozo-arrastre-agenciero" class="form-control" placeholder="0"
                style="padding-left: 25px; font-size: 1.1rem;">
            </div>
          </div>
        </div>
        <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem; justify-content: flex-end;">
          <button class="btn btn-secondary" onclick="cerrarModalPozosArrastre()">Cancelar</button>
          <button class="btn btn-primary" onclick="aplicarPozosArrastre()">
            <i class="fas fa-check"></i> Aplicar Arrastres
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container"></div>

  <script src="js/api.js?v=20260205e"></script>
  <script src="js/ocr-extractos.js?v=20260205e"></script>
  <script src="js/app.js?v=20260205e"></script>
</body>

</html>